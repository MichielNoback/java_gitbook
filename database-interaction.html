<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 36 Database interaction | The Java Track</title>
  <meta name="description" content="This ebook accompanies the Java course track of bioinformatics at the Hanze University of Applied Science, Groningen (The Netherlands)." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 36 Database interaction | The Java Track" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This ebook accompanies the Java course track of bioinformatics at the Hanze University of Applied Science, Groningen (The Netherlands)." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 36 Database interaction | The Java Track" />
  
  <meta name="twitter:description" content="This ebook accompanies the Java course track of bioinformatics at the Hanze University of Applied Science, Groningen (The Netherlands)." />
  

<meta name="author" content="Michiel Noback" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="servlet-details-and-lifecycle-hooks.html"/>
<link rel="next" href="a-simple-web-service-using-ajax.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Java eBook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> General introduction</a></li>
<li class="chapter" data-level="2" data-path="keyboard-shortcuts.html"><a href="keyboard-shortcuts.html"><i class="fa fa-check"></i><b>2</b> Keyboard shortcuts</a></li>
<li class="part"><span><b>Part I - Getting Started</b></span></li>
<li class="chapter" data-level="3" data-path="a-first-intellij-project.html"><a href="a-first-intellij-project.html"><i class="fa fa-check"></i><b>3</b> A first IntelliJ project</a><ul>
<li class="chapter" data-level="3.1" data-path="a-first-intellij-project.html"><a href="a-first-intellij-project.html#dependency-management"><i class="fa fa-check"></i><b>3.1</b> Dependency management</a></li>
<li class="chapter" data-level="3.2" data-path="a-first-intellij-project.html"><a href="a-first-intellij-project.html#a-first-project"><i class="fa fa-check"></i><b>3.2</b> A first project</a></li>
<li class="chapter" data-level="3.3" data-path="a-first-intellij-project.html"><a href="a-first-intellij-project.html#distribute-an-executable"><i class="fa fa-check"></i><b>3.3</b> Distribute an executable</a></li>
<li class="chapter" data-level="3.4" data-path="a-first-intellij-project.html"><a href="a-first-intellij-project.html#wrap-up"><i class="fa fa-check"></i><b>3.4</b> Wrap-up</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html"><i class="fa fa-check"></i><b>4</b> The essence of Java</a><ul>
<li class="chapter" data-level="4.1" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html#cross-platform"><i class="fa fa-check"></i><b>4.1</b> Cross-platform</a></li>
<li class="chapter" data-level="4.2" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html#multithreaded"><i class="fa fa-check"></i><b>4.2</b> Multithreaded</a></li>
<li class="chapter" data-level="4.3" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html#object-oriented"><i class="fa fa-check"></i><b>4.3</b> Object-Oriented</a></li>
<li class="chapter" data-level="4.4" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html#strongly-typed-and-scoped"><i class="fa fa-check"></i><b>4.4</b> Strongly typed and scoped</a></li>
<li class="chapter" data-level="4.5" data-path="the-essence-of-java.html"><a href="the-essence-of-java.html#compiled"><i class="fa fa-check"></i><b>4.5</b> Compiled</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="first-look-at-objects.html"><a href="first-look-at-objects.html"><i class="fa fa-check"></i><b>5</b> Objects: ninjas and growing cells</a><ul>
<li class="chapter" data-level="5.1" data-path="first-look-at-objects.html"><a href="first-look-at-objects.html#ninjas"><i class="fa fa-check"></i><b>5.1</b> Ninjas</a></li>
<li class="chapter" data-level="5.2" data-path="first-look-at-objects.html"><a href="first-look-at-objects.html#growing-cells"><i class="fa fa-check"></i><b>5.2</b> Growing cells</a></li>
<li class="chapter" data-level="5.3" data-path="first-look-at-objects.html"><a href="first-look-at-objects.html#object-construction-first-iteration"><i class="fa fa-check"></i><b>5.3</b> Object construction (first iteration)</a></li>
<li class="chapter" data-level="5.4" data-path="first-look-at-objects.html"><a href="first-look-at-objects.html#inheritance-first-discussion"><i class="fa fa-check"></i><b>5.4</b> Inheritance (first discussion)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basic-program-structure-and-flow.html"><a href="basic-program-structure-and-flow.html"><i class="fa fa-check"></i><b>6</b> Basic program structure and flow</a><ul>
<li class="chapter" data-level="6.1" data-path="basic-program-structure-and-flow.html"><a href="basic-program-structure-and-flow.html#basic-program-structure"><i class="fa fa-check"></i><b>6.1</b> Basic program structure</a></li>
<li class="chapter" data-level="6.2" data-path="basic-program-structure-and-flow.html"><a href="basic-program-structure-and-flow.html#summary"><i class="fa fa-check"></i><b>6.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="naming-and-commenting-stuff.html"><a href="naming-and-commenting-stuff.html"><i class="fa fa-check"></i><b>7</b> Naming and commenting stuff</a><ul>
<li class="chapter" data-level="7.1" data-path="naming-and-commenting-stuff.html"><a href="naming-and-commenting-stuff.html#naming"><i class="fa fa-check"></i><b>7.1</b> Naming</a></li>
<li class="chapter" data-level="7.2" data-path="naming-and-commenting-stuff.html"><a href="naming-and-commenting-stuff.html#commenting"><i class="fa fa-check"></i><b>7.2</b> Commenting</a></li>
</ul></li>
<li class="part"><span><b>Part II - Syntax</b></span></li>
<li class="chapter" data-level="8" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>8</b> Data Types</a><ul>
<li class="chapter" data-level="8.1" data-path="data-types.html"><a href="data-types.html#primitives"><i class="fa fa-check"></i><b>8.1</b> Primitives</a></li>
<li class="chapter" data-level="8.2" data-path="data-types.html"><a href="data-types.html#reference-types"><i class="fa fa-check"></i><b>8.2</b> Reference types</a></li>
<li class="chapter" data-level="8.3" data-path="data-types.html"><a href="data-types.html#what-is-the-difference"><i class="fa fa-check"></i><b>8.3</b> What is the difference?</a></li>
<li class="chapter" data-level="8.4" data-path="data-types.html"><a href="data-types.html#summary-1"><i class="fa fa-check"></i><b>8.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="arrays.html"><a href="arrays.html"><i class="fa fa-check"></i><b>9</b> Arrays</a><ul>
<li class="chapter" data-level="9.1" data-path="arrays.html"><a href="arrays.html#creating-arrays"><i class="fa fa-check"></i><b>9.1</b> Creating arrays</a></li>
<li class="chapter" data-level="9.2" data-path="arrays.html"><a href="arrays.html#printing"><i class="fa fa-check"></i><b>9.2</b> Printing</a></li>
<li class="chapter" data-level="9.3" data-path="arrays.html"><a href="arrays.html#accessing"><i class="fa fa-check"></i><b>9.3</b> Accessing</a></li>
<li class="chapter" data-level="9.4" data-path="arrays.html"><a href="arrays.html#multidimensional-arrays"><i class="fa fa-check"></i><b>9.4</b> Multidimensional arrays</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="operators.html"><a href="operators.html"><i class="fa fa-check"></i><b>10</b> Operators</a><ul>
<li class="chapter" data-level="10.1" data-path="operators.html"><a href="operators.html#overview"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="flow-control.html"><a href="flow-control.html"><i class="fa fa-check"></i><b>11</b> Flow control</a><ul>
<li class="chapter" data-level="11.1" data-path="flow-control.html"><a href="flow-control.html#if-else-if-else"><i class="fa fa-check"></i><b>11.1</b> if [else if] [else]</a></li>
<li class="chapter" data-level="11.2" data-path="flow-control.html"><a href="flow-control.html#while"><i class="fa fa-check"></i><b>11.2</b> while</a></li>
<li class="chapter" data-level="11.3" data-path="flow-control.html"><a href="flow-control.html#for"><i class="fa fa-check"></i><b>11.3</b> for</a></li>
<li class="chapter" data-level="11.4" data-path="flow-control.html"><a href="flow-control.html#break-and-continue"><i class="fa fa-check"></i><b>11.4</b> break and continue</a></li>
<li class="chapter" data-level="11.5" data-path="flow-control.html"><a href="flow-control.html#switchcase"><i class="fa fa-check"></i><b>11.5</b> switch/case</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="methods-1.html"><a href="methods-1.html"><i class="fa fa-check"></i><b>12</b> Methods</a><ul>
<li class="chapter" data-level="12.1" data-path="methods-1.html"><a href="methods-1.html#method-signature"><i class="fa fa-check"></i><b>12.1</b> Method signature</a></li>
<li class="chapter" data-level="12.2" data-path="methods-1.html"><a href="methods-1.html#interacting-with-state"><i class="fa fa-check"></i><b>12.2</b> Interacting with state</a></li>
<li class="chapter" data-level="12.3" data-path="methods-1.html"><a href="methods-1.html#method-overloading"><i class="fa fa-check"></i><b>12.3</b> Method overloading</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="packages-and-imports.html"><a href="packages-and-imports.html"><i class="fa fa-check"></i><b>13</b> Packages and Imports</a><ul>
<li class="chapter" data-level="13.1" data-path="packages-and-imports.html"><a href="packages-and-imports.html#class-path"><i class="fa fa-check"></i><b>13.1</b> Class path</a></li>
<li class="chapter" data-level="13.2" data-path="packages-and-imports.html"><a href="packages-and-imports.html#namespaces"><i class="fa fa-check"></i><b>13.2</b> Namespaces</a></li>
<li class="chapter" data-level="13.3" data-path="packages-and-imports.html"><a href="packages-and-imports.html#packages"><i class="fa fa-check"></i><b>13.3</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="the-power-of-naming.html"><a href="the-power-of-naming.html"><i class="fa fa-check"></i><b>14</b> The power of naming</a></li>
<li class="part"><span><b>Part III - Core APIs</b></span></li>
<li class="chapter" data-level="15" data-path="interfaces.html"><a href="interfaces.html"><i class="fa fa-check"></i><b>15</b> Interfaces</a><ul>
<li class="chapter" data-level="15.1" data-path="interfaces.html"><a href="interfaces.html#a-contract-without-implementation-interface"><i class="fa fa-check"></i><b>15.1</b> A contract without implementation: interface</a></li>
<li class="chapter" data-level="15.2" data-path="interfaces.html"><a href="interfaces.html#summary-2"><i class="fa fa-check"></i><b>15.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="the-java-collections-api.html"><a href="the-java-collections-api.html"><i class="fa fa-check"></i><b>16</b> The Java Collections API</a><ul>
<li class="chapter" data-level="16.1" data-path="the-java-collections-api.html"><a href="the-java-collections-api.html#lists-arraylist-and-linkedlist"><i class="fa fa-check"></i><b>16.1</b> Lists: ArrayList and LinkedList</a></li>
<li class="chapter" data-level="16.2" data-path="the-java-collections-api.html"><a href="the-java-collections-api.html#code-against-interfaces-not-implementations"><i class="fa fa-check"></i><b>16.2</b> Code against interfaces, not implementations</a></li>
<li class="chapter" data-level="16.3" data-path="the-java-collections-api.html"><a href="the-java-collections-api.html#the-collection-interfaces-map-list-set"><i class="fa fa-check"></i><b>16.3</b> The collection interfaces: Map, List, Set</a></li>
<li class="chapter" data-level="16.4" data-path="the-java-collections-api.html"><a href="the-java-collections-api.html#collections-utility-methods"><i class="fa fa-check"></i><b>16.4</b> Collections utility methods</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="methods-of-class-object.html"><a href="methods-of-class-object.html"><i class="fa fa-check"></i><b>17</b> Methods of class Object</a><ul>
<li class="chapter" data-level="17.1" data-path="methods-of-class-object.html"><a href="methods-of-class-object.html#tostring-equals-hashcode-getclass"><i class="fa fa-check"></i><b>17.1</b> toString(), equals(), hashCode(), getClass()</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="sorting.html"><a href="sorting.html"><i class="fa fa-check"></i><b>18</b> Sorting</a><ul>
<li class="chapter" data-level="18.1" data-path="sorting.html"><a href="sorting.html#natural-sorting-with-the-comparable-interface"><i class="fa fa-check"></i><b>18.1</b> “Natural” sorting with the <code>Comparable</code> interface</a></li>
<li class="chapter" data-level="18.2" data-path="sorting.html"><a href="sorting.html#sorting-using-a-custom-comparator"><i class="fa fa-check"></i><b>18.2</b> Sorting using a custom <code>Comparator</code></a></li>
<li class="chapter" data-level="18.3" data-path="sorting.html"><a href="sorting.html#multilevel-sorting"><i class="fa fa-check"></i><b>18.3</b> Multilevel sorting</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="exceptions.html"><a href="exceptions.html"><i class="fa fa-check"></i><b>19</b> Exceptions</a><ul>
<li class="chapter" data-level="19.1" data-path="exceptions.html"><a href="exceptions.html#what-are-exceptions"><i class="fa fa-check"></i><b>19.1</b> What are exceptions</a></li>
<li class="chapter" data-level="19.2" data-path="exceptions.html"><a href="exceptions.html#checked-and-unchecked-exceptions"><i class="fa fa-check"></i><b>19.2</b> Checked and unchecked exceptions</a></li>
<li class="chapter" data-level="19.3" data-path="exceptions.html"><a href="exceptions.html#all-trycatch-elements"><i class="fa fa-check"></i><b>19.3</b> All try/catch elements</a></li>
<li class="chapter" data-level="19.4" data-path="exceptions.html"><a href="exceptions.html#try-with-resources"><i class="fa fa-check"></i><b>19.4</b> Try-with resources</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="file-io.html"><a href="file-io.html"><i class="fa fa-check"></i><b>20</b> File IO</a><ul>
<li class="chapter" data-level="20.1" data-path="file-io.html"><a href="file-io.html#path-paths"><i class="fa fa-check"></i><b>20.1</b> Path &amp; Paths</a></li>
<li class="chapter" data-level="20.2" data-path="file-io.html"><a href="file-io.html#file-and-files"><i class="fa fa-check"></i><b>20.2</b> File and Files</a></li>
<li class="chapter" data-level="20.3" data-path="file-io.html"><a href="file-io.html#parsing-file-content-the-easy-way"><i class="fa fa-check"></i><b>20.3</b> Parsing file content the easy way</a></li>
<li class="chapter" data-level="20.4" data-path="file-io.html"><a href="file-io.html#note-on-character-sets"><i class="fa fa-check"></i><b>20.4</b> Note on character sets</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="regular-expressions.html"><a href="regular-expressions.html"><i class="fa fa-check"></i><b>21</b> Regular Expressions</a><ul>
<li class="chapter" data-level="21.1" data-path="regular-expressions.html"><a href="regular-expressions.html#regex-syntax"><i class="fa fa-check"></i><b>21.1</b> Regex syntax?</a></li>
<li class="chapter" data-level="21.2" data-path="regular-expressions.html"><a href="regular-expressions.html#methods-of-class-string"><i class="fa fa-check"></i><b>21.2</b> Methods of class String</a></li>
<li class="chapter" data-level="21.3" data-path="regular-expressions.html"><a href="regular-expressions.html#pattern-matcher"><i class="fa fa-check"></i><b>21.3</b> Pattern &amp; Matcher</a></li>
</ul></li>
<li class="part"><span><b>Part IV - OOP</b></span></li>
<li class="chapter" data-level="22" data-path="encapsulation.html"><a href="encapsulation.html"><i class="fa fa-check"></i><b>22</b> Encapsulation</a><ul>
<li class="chapter" data-level="22.1" data-path="encapsulation.html"><a href="encapsulation.html#summary-3"><i class="fa fa-check"></i><b>22.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="access-modifiers-other-keywords.html"><a href="access-modifiers-other-keywords.html"><i class="fa fa-check"></i><b>23</b> Access modifiers &amp; Other keywords</a><ul>
<li class="chapter" data-level="23.1" data-path="access-modifiers-other-keywords.html"><a href="access-modifiers-other-keywords.html#access-modifiers"><i class="fa fa-check"></i><b>23.1</b> Access Modifiers</a></li>
<li class="chapter" data-level="23.2" data-path="access-modifiers-other-keywords.html"><a href="access-modifiers-other-keywords.html#other-keywords"><i class="fa fa-check"></i><b>23.2</b> Other keywords</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="inheritance-and-uml.html"><a href="inheritance-and-uml.html"><i class="fa fa-check"></i><b>24</b> Inheritance and UML</a><ul>
<li class="chapter" data-level="24.1" data-path="inheritance-and-uml.html"><a href="inheritance-and-uml.html#the-testtube-with-cells"><i class="fa fa-check"></i><b>24.1</b> The TestTube with cells</a></li>
<li class="chapter" data-level="24.2" data-path="inheritance-and-uml.html"><a href="inheritance-and-uml.html#apply-inheritance-to-model-what-is-common"><i class="fa fa-check"></i><b>24.2</b> Apply inheritance to model what is common</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="enums-constants-on-steroids.html"><a href="enums-constants-on-steroids.html"><i class="fa fa-check"></i><b>25</b> Enums: constants on steroids</a><ul>
<li class="chapter" data-level="25.1" data-path="enums-constants-on-steroids.html"><a href="enums-constants-on-steroids.html#constants-are-everywhere"><i class="fa fa-check"></i><b>25.1</b> Constants are everywhere</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="encapsulation-revisited.html"><a href="encapsulation-revisited.html"><i class="fa fa-check"></i><b>26</b> Encapsulation revisited</a></li>
<li class="chapter" data-level="27" data-path="design-rules-summary.html"><a href="design-rules-summary.html"><i class="fa fa-check"></i><b>27</b> Design rules summary</a><ul>
<li class="chapter" data-level="27.1" data-path="design-rules-summary.html"><a href="design-rules-summary.html#equals-and-hashcode"><i class="fa fa-check"></i><b>27.1</b> equals() and hashCode()</a></li>
<li class="chapter" data-level="27.2" data-path="design-rules-summary.html"><a href="design-rules-summary.html#classes-1"><i class="fa fa-check"></i><b>27.2</b> Classes</a></li>
<li class="chapter" data-level="27.3" data-path="design-rules-summary.html"><a href="design-rules-summary.html#code-against-interfaces-not-implementations-1"><i class="fa fa-check"></i><b>27.3</b> Code against interfaces, not implementations</a></li>
<li class="chapter" data-level="27.4" data-path="design-rules-summary.html"><a href="design-rules-summary.html#exceptions-1"><i class="fa fa-check"></i><b>27.4</b> Exceptions</a></li>
<li class="chapter" data-level="27.5" data-path="design-rules-summary.html"><a href="design-rules-summary.html#access-modifiers-1"><i class="fa fa-check"></i><b>27.5</b> Access modifiers</a></li>
<li class="chapter" data-level="27.6" data-path="design-rules-summary.html"><a href="design-rules-summary.html#srp"><i class="fa fa-check"></i><b>27.6</b> SRP</a></li>
<li class="chapter" data-level="27.7" data-path="design-rules-summary.html"><a href="design-rules-summary.html#various"><i class="fa fa-check"></i><b>27.7</b> Various</a></li>
</ul></li>
<li class="part"><span><b>Part V - Java Web Apps</b></span></li>
<li class="chapter" data-level="28" data-path="a-refresher.html"><a href="a-refresher.html"><i class="fa fa-check"></i><b>28</b> A refresher</a><ul>
<li class="chapter" data-level="28.1" data-path="a-refresher.html"><a href="a-refresher.html#introduction"><i class="fa fa-check"></i><b>28.1</b> Introduction</a></li>
<li class="chapter" data-level="28.2" data-path="a-refresher.html"><a href="a-refresher.html#the-basics-of-web"><i class="fa fa-check"></i><b>28.2</b> The basics of web</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="the-toolbox.html"><a href="the-toolbox.html"><i class="fa fa-check"></i><b>29</b> The toolbox</a></li>
<li class="chapter" data-level="30" data-path="a-first-project-1.html"><a href="a-first-project-1.html"><i class="fa fa-check"></i><b>30</b> A first project</a><ul>
<li class="chapter" data-level="30.1" data-path="a-first-project-1.html"><a href="a-first-project-1.html#introduction-1"><i class="fa fa-check"></i><b>30.1</b> Introduction</a></li>
<li class="chapter" data-level="30.2" data-path="a-first-project-1.html"><a href="a-first-project-1.html#the-steps"><i class="fa fa-check"></i><b>30.2</b> The steps</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="implementing-mvc.html"><a href="implementing-mvc.html"><i class="fa fa-check"></i><b>31</b> Implementing MVC</a><ul>
<li class="chapter" data-level="31.1" data-path="implementing-mvc.html"><a href="implementing-mvc.html#introduction-2"><i class="fa fa-check"></i><b>31.1</b> Introduction</a></li>
<li class="chapter" data-level="31.2" data-path="implementing-mvc.html"><a href="implementing-mvc.html#java-web-app-architecture"><i class="fa fa-check"></i><b>31.2</b> Java web app architecture</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="thymeleaf-expressions.html"><a href="thymeleaf-expressions.html"><i class="fa fa-check"></i><b>32</b> Thymeleaf expressions</a><ul>
<li class="chapter" data-level="32.1" data-path="thymeleaf-expressions.html"><a href="thymeleaf-expressions.html#introduction-3"><i class="fa fa-check"></i><b>32.1</b> Introduction</a></li>
<li class="chapter" data-level="32.2" data-path="thymeleaf-expressions.html"><a href="thymeleaf-expressions.html#expression-types"><i class="fa fa-check"></i><b>32.2</b> Expression types</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="thymeleaf-flow-control-and-fragments.html"><a href="thymeleaf-flow-control-and-fragments.html"><i class="fa fa-check"></i><b>33</b> Thymeleaf flow control and fragments</a><ul>
<li class="chapter" data-level="33.1" data-path="thymeleaf-flow-control-and-fragments.html"><a href="thymeleaf-flow-control-and-fragments.html#introduction-4"><i class="fa fa-check"></i><b>33.1</b> Introduction</a></li>
<li class="chapter" data-level="33.2" data-path="thymeleaf-flow-control-and-fragments.html"><a href="thymeleaf-flow-control-and-fragments.html#working-with-fragments"><i class="fa fa-check"></i><b>33.2</b> Working with fragments</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="sessions-scopes.html"><a href="sessions-scopes.html"><i class="fa fa-check"></i><b>34</b> Sessions &amp; Scopes</a><ul>
<li class="chapter" data-level="34.1" data-path="sessions-scopes.html"><a href="sessions-scopes.html#introduction-5"><i class="fa fa-check"></i><b>34.1</b> Introduction</a></li>
<li class="chapter" data-level="34.2" data-path="sessions-scopes.html"><a href="sessions-scopes.html#scopes"><i class="fa fa-check"></i><b>34.2</b> Scopes</a></li>
<li class="chapter" data-level="34.3" data-path="sessions-scopes.html"><a href="sessions-scopes.html#summary-of-scopes"><i class="fa fa-check"></i><b>34.3</b> Summary of scopes</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="servlet-details-and-lifecycle-hooks.html"><a href="servlet-details-and-lifecycle-hooks.html"><i class="fa fa-check"></i><b>35</b> Servlet details and lifecycle hooks</a><ul>
<li class="chapter" data-level="35.1" data-path="servlet-details-and-lifecycle-hooks.html"><a href="servlet-details-and-lifecycle-hooks.html#servlet-configuration"><i class="fa fa-check"></i><b>35.1</b> Servlet configuration</a></li>
<li class="chapter" data-level="35.2" data-path="servlet-details-and-lifecycle-hooks.html"><a href="servlet-details-and-lifecycle-hooks.html#hooks"><i class="fa fa-check"></i><b>35.2</b> Hooks</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="database-interaction.html"><a href="database-interaction.html"><i class="fa fa-check"></i><b>36</b> Database interaction</a><ul>
<li class="chapter" data-level="36.1" data-path="database-interaction.html"><a href="database-interaction.html#jdbc"><i class="fa fa-check"></i><b>36.1</b> JDBC</a></li>
<li class="chapter" data-level="36.2" data-path="database-interaction.html"><a href="database-interaction.html#the-naive-implementation"><i class="fa fa-check"></i><b>36.2</b> The naive implementation</a></li>
<li class="chapter" data-level="36.3" data-path="database-interaction.html"><a href="database-interaction.html#improve-on-naive-implementation"><i class="fa fa-check"></i><b>36.3</b> Improve on naive implementation</a></li>
<li class="chapter" data-level="36.4" data-path="database-interaction.html"><a href="database-interaction.html#refactoring-to-oo-principles"><i class="fa fa-check"></i><b>36.4</b> Refactoring to OO principles</a></li>
<li class="chapter" data-level="36.5" data-path="database-interaction.html"><a href="database-interaction.html#use-in-a-servlet-environment"><i class="fa fa-check"></i><b>36.5</b> Use in a servlet environment</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="a-simple-web-service-using-ajax.html"><a href="a-simple-web-service-using-ajax.html"><i class="fa fa-check"></i><b>37</b> A simple web service using Ajax</a><ul>
<li class="chapter" data-level="37.1" data-path="a-simple-web-service-using-ajax.html"><a href="a-simple-web-service-using-ajax.html#introduction-6"><i class="fa fa-check"></i><b>37.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="web-filters-and-file-uploads.html"><a href="web-filters-and-file-uploads.html"><i class="fa fa-check"></i><b>38</b> Web filters and File uploads</a><ul>
<li class="chapter" data-level="38.1" data-path="web-filters-and-file-uploads.html"><a href="web-filters-and-file-uploads.html#web-filters"><i class="fa fa-check"></i><b>38.1</b> Web filters</a></li>
<li class="chapter" data-level="38.2" data-path="web-filters-and-file-uploads.html"><a href="web-filters-and-file-uploads.html#file-uploads"><i class="fa fa-check"></i><b>38.2</b> File uploads</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="exercises-intro.html"><a href="exercises-intro.html"><i class="fa fa-check"></i><b>39</b> Exercises intro</a><ul>
<li class="chapter" data-level="39.1" data-path="exercises-intro.html"><a href="exercises-intro.html#implementing-mvc-1"><i class="fa fa-check"></i><b>39.1</b> Implementing MVC</a></li>
<li class="chapter" data-level="39.2" data-path="exercises-intro.html"><a href="exercises-intro.html#thymeleaf"><i class="fa fa-check"></i><b>39.2</b> Thymeleaf</a></li>
<li class="chapter" data-level="39.3" data-path="exercises-intro.html"><a href="exercises-intro.html#sessions"><i class="fa fa-check"></i><b>39.3</b> Sessions</a></li>
<li class="chapter" data-level="39.4" data-path="exercises-intro.html"><a href="exercises-intro.html#authentication-1"><i class="fa fa-check"></i><b>39.4</b> Authentication</a></li>
<li class="chapter" data-level="39.5" data-path="exercises-intro.html"><a href="exercises-intro.html#servlet-details-and-hooks"><i class="fa fa-check"></i><b>39.5</b> Servlet details and hooks</a></li>
<li class="chapter" data-level="39.6" data-path="exercises-intro.html"><a href="exercises-intro.html#database-interaction-1"><i class="fa fa-check"></i><b>39.6</b> Database interaction</a></li>
<li class="chapter" data-level="39.7" data-path="exercises-intro.html"><a href="exercises-intro.html#ajax"><i class="fa fa-check"></i><b>39.7</b> Ajax</a></li>
<li class="chapter" data-level="39.8" data-path="exercises-intro.html"><a href="exercises-intro.html#filters"><i class="fa fa-check"></i><b>39.8</b> Filters</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="html5-tags.html"><a href="html5-tags.html"><i class="fa fa-check"></i><b>40</b> HTML5 tags</a></li>
<li class="part"><span><b>Part VI - JUnit</b></span></li>
<li class="chapter" data-level="41" data-path="junit-5-basics.html"><a href="junit-5-basics.html"><i class="fa fa-check"></i><b>41</b> JUnit 5 basics</a><ul>
<li class="chapter" data-level="41.1" data-path="junit-5-basics.html"><a href="junit-5-basics.html#introduction-7"><i class="fa fa-check"></i><b>41.1</b> Introduction</a></li>
<li class="chapter" data-level="41.2" data-path="junit-5-basics.html"><a href="junit-5-basics.html#reasons-for-unit-testing"><i class="fa fa-check"></i><b>41.2</b> Reasons for unit testing</a></li>
<li class="chapter" data-level="41.3" data-path="junit-5-basics.html"><a href="junit-5-basics.html#running-junit-5-tests-using-gradle-and-intellij"><i class="fa fa-check"></i><b>41.3</b> Running JUnit 5 tests using Gradle and IntelliJ</a></li>
<li class="chapter" data-level="41.4" data-path="junit-5-basics.html"><a href="junit-5-basics.html#document"><i class="fa fa-check"></i><b>41.4</b> Document!</a></li>
<li class="chapter" data-level="41.5" data-path="junit-5-basics.html"><a href="junit-5-basics.html#junit-assert...-methods"><i class="fa fa-check"></i><b>41.5</b> JUnit <code>assert...()</code> methods</a></li>
<li class="chapter" data-level="41.6" data-path="junit-5-basics.html"><a href="junit-5-basics.html#testing-for-exceptions"><i class="fa fa-check"></i><b>41.6</b> Testing for Exceptions</a></li>
<li class="chapter" data-level="41.7" data-path="junit-5-basics.html"><a href="junit-5-basics.html#grouping-assertions-using-assertall"><i class="fa fa-check"></i><b>41.7</b> Grouping assertions using <code>assertAll()</code></a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="junit-5-advanced-features.html"><a href="junit-5-advanced-features.html"><i class="fa fa-check"></i><b>42</b> JUnit 5 advanced features</a><ul>
<li class="chapter" data-level="42.1" data-path="junit-5-advanced-features.html"><a href="junit-5-advanced-features.html#introduction-8"><i class="fa fa-check"></i><b>42.1</b> Introduction</a></li>
<li class="chapter" data-level="42.2" data-path="junit-5-advanced-features.html"><a href="junit-5-advanced-features.html#junit-5-annotations"><i class="fa fa-check"></i><b>42.2</b> JUnit 5 annotations</a></li>
</ul></li>
<li class="part"><span><b>Part VII - Design</b></span></li>
<li class="chapter" data-level="43" data-path="uml.html"><a href="uml.html"><i class="fa fa-check"></i><b>43</b> UML</a></li>
<li class="chapter" data-level="44" data-path="refactoring.html"><a href="refactoring.html"><i class="fa fa-check"></i><b>44</b> Refactoring</a><ul>
<li class="chapter" data-level="44.1" data-path="refactoring.html"><a href="refactoring.html#introduction-9"><i class="fa fa-check"></i><b>44.1</b> Introduction</a></li>
<li class="chapter" data-level="44.2" data-path="refactoring.html"><a href="refactoring.html#get-to-know-what-is-there"><i class="fa fa-check"></i><b>44.2</b> Get to know what is there</a></li>
<li class="chapter" data-level="44.3" data-path="refactoring.html"><a href="refactoring.html#refactor"><i class="fa fa-check"></i><b>44.3</b> Refactor</a></li>
<li class="chapter" data-level="44.4" data-path="refactoring.html"><a href="refactoring.html#take-over"><i class="fa fa-check"></i><b>44.4</b> Take over</a></li>
</ul></li>
<li class="part"><span><b>Part VIII - Spring Boot</b></span></li>
<li class="chapter" data-level="45" data-path="rest-and-mvc-with-spring.html"><a href="rest-and-mvc-with-spring.html"><i class="fa fa-check"></i><b>45</b> REST and MVC with Spring</a><ul>
<li class="chapter" data-level="45.1" data-path="rest-and-mvc-with-spring.html"><a href="rest-and-mvc-with-spring.html#create-a-new-project"><i class="fa fa-check"></i><b>45.1</b> Create a new project</a></li>
<li class="chapter" data-level="45.2" data-path="rest-and-mvc-with-spring.html"><a href="rest-and-mvc-with-spring.html#create-a-rest-response"><i class="fa fa-check"></i><b>45.2</b> Create a REST response</a></li>
</ul></li>
<li class="chapter" data-level="46" data-path="dependency-injection-in-spring.html"><a href="dependency-injection-in-spring.html"><i class="fa fa-check"></i><b>46</b> Dependency Injection in Spring</a></li>
<li class="chapter" data-level="47" data-path="core-spring-annotations.html"><a href="core-spring-annotations.html"><i class="fa fa-check"></i><b>47</b> Core (Spring) annotations</a><ul>
<li class="chapter" data-level="47.1" data-path="core-spring-annotations.html"><a href="core-spring-annotations.html#generic-annotations"><i class="fa fa-check"></i><b>47.1</b> Generic annotations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Java Track</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="database-interaction" class="section level1">
<h1><span class="header-section-number">Chapter 36</span> Database interaction</h1>
<p>In this post, these topics will be discussed:
- Database interaction with Java applications: JDBC
- Java design issues that ensure flexible, reusable code that will easily deal with changing specs:
- a different database provider
- a different view
- different analysis components
- etc etc</p>
<p>Just remember: <strong><em>the only constant in programming is change</em></strong>.</p>
<p>⇒ Have a look at the <a href="https://bitbucket.org/minoba/java_web_thymeleaf_demo">repo</a> to see the full code of these examples.</p>
<div id="jdbc" class="section level2">
<h2><span class="header-section-number">36.1</span> JDBC</h2>
<p>Having Java applications talk with MySQL databases require that you have the required Driver in your project class path. Let’s start with that. Put this line in te dependencies section of your <code>build.gradle</code> file:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb282-1"><a href="database-interaction.html#cb282-1"></a><span class="co">// https://mvnrepository.com/artifact/mysql/mysql-connector-java  </span></span>
<span id="cb282-2"><a href="database-interaction.html#cb282-2"></a>compile group<span class="op">:</span> <span class="st">&#39;mysql&#39;</span><span class="op">,</span> name<span class="op">:</span> <span class="st">&#39;mysql-connector-java&#39;</span><span class="op">,</span> version<span class="op">:</span> <span class="st">&#39;5.1.6&#39;</span></span></code></pre></div>
<p>You may need to refresh your Gradle project in the Gradle Tool window, if you did not check the auto refresh option when creating the project.</p>
<div class="figure">
<img src="05_web/figures/refresh_gradle_project.png" alt="" />
<p class="caption">Refresh project</p>
</div>
<div id="the-database" class="section level4 unnumbered">
<h4>The database</h4>
<p>Of course, you will need a MySQL server, a database and an account. Deal with that first before proceeding, if you don’t have that!</p>
<p>Suppose we have a database called MyDB with this single, simple table <code>Users</code>:</p>
<table>
<thead>
<tr class="header">
<th>Field</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>user_id</code></td>
<td><code>int AUTO-INCREMENT</code></td>
</tr>
<tr class="even">
<td><code>user_name</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr class="odd">
<td><code>user_password</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr class="even">
<td><code>user_email</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr class="odd">
<td><code>role</code></td>
<td><code>enum('GUEST', 'USER', 'ADMIN')</code></td>
</tr>
</tbody>
</table>
</div>
<div id="the-model-classes" class="section level4 unnumbered">
<h4>The model classes</h4>
<p>These are the model classes that play a role in this chapter on database interaction.
Class <code>User</code>, a class that models visitors/users of a website:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb283-1"><a href="database-interaction.html#cb283-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model;</span></span>
<span id="cb283-2"><a href="database-interaction.html#cb283-2"></a></span>
<span id="cb283-3"><a href="database-interaction.html#cb283-3"></a><span class="kw">import</span><span class="im"> java.util.ArrayList;</span></span>
<span id="cb283-4"><a href="database-interaction.html#cb283-4"></a><span class="kw">import</span><span class="im"> java.util.List;</span></span>
<span id="cb283-5"><a href="database-interaction.html#cb283-5"></a><span class="kw">import</span><span class="im"> java.util.Objects;</span></span>
<span id="cb283-6"><a href="database-interaction.html#cb283-6"></a></span>
<span id="cb283-7"><a href="database-interaction.html#cb283-7"></a><span class="kw">public</span> <span class="kw">class</span> User {</span>
<span id="cb283-8"><a href="database-interaction.html#cb283-8"></a>    <span class="kw">private</span> <span class="bu">String</span> name;</span>
<span id="cb283-9"><a href="database-interaction.html#cb283-9"></a>    <span class="kw">private</span> <span class="bu">String</span> email;</span>
<span id="cb283-10"><a href="database-interaction.html#cb283-10"></a>    <span class="kw">private</span> <span class="bu">String</span> password;</span>
<span id="cb283-11"><a href="database-interaction.html#cb283-11"></a>    <span class="kw">private</span> <span class="bu">Role</span> role;</span>
<span id="cb283-12"><a href="database-interaction.html#cb283-12"></a></span>
<span id="cb283-13"><a href="database-interaction.html#cb283-13"></a>    <span class="kw">public</span> <span class="fu">User</span>() { }</span>
<span id="cb283-14"><a href="database-interaction.html#cb283-14"></a></span>
<span id="cb283-15"><a href="database-interaction.html#cb283-15"></a>    <span class="kw">public</span> <span class="fu">User</span>(<span class="bu">String</span> name, <span class="bu">String</span> email, <span class="bu">Role</span> role) {</span>
<span id="cb283-16"><a href="database-interaction.html#cb283-16"></a>        <span class="kw">this</span>.<span class="fu">name</span> = name;</span>
<span id="cb283-17"><a href="database-interaction.html#cb283-17"></a>        <span class="kw">this</span>.<span class="fu">email</span> = email;</span>
<span id="cb283-18"><a href="database-interaction.html#cb283-18"></a>        <span class="kw">this</span>.<span class="fu">role</span> = role;</span>
<span id="cb283-19"><a href="database-interaction.html#cb283-19"></a>    }</span>
<span id="cb283-20"><a href="database-interaction.html#cb283-20"></a></span>
<span id="cb283-21"><a href="database-interaction.html#cb283-21"></a>    <span class="kw">public</span> <span class="fu">User</span>(<span class="bu">String</span> name, <span class="bu">String</span> email, <span class="bu">String</span> password, <span class="bu">Role</span> role) {</span>
<span id="cb283-22"><a href="database-interaction.html#cb283-22"></a>        <span class="kw">this</span>.<span class="fu">name</span> = name;</span>
<span id="cb283-23"><a href="database-interaction.html#cb283-23"></a>        <span class="kw">this</span>.<span class="fu">email</span> = email;</span>
<span id="cb283-24"><a href="database-interaction.html#cb283-24"></a>        <span class="kw">this</span>.<span class="fu">password</span> = password;</span>
<span id="cb283-25"><a href="database-interaction.html#cb283-25"></a>        <span class="kw">this</span>.<span class="fu">role</span> = role;</span>
<span id="cb283-26"><a href="database-interaction.html#cb283-26"></a>    }</span>
<span id="cb283-27"><a href="database-interaction.html#cb283-27"></a></span>
<span id="cb283-28"><a href="database-interaction.html#cb283-28"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setPassword</span>(<span class="bu">String</span> password) {</span>
<span id="cb283-29"><a href="database-interaction.html#cb283-29"></a>        <span class="kw">this</span>.<span class="fu">password</span> = password;</span>
<span id="cb283-30"><a href="database-interaction.html#cb283-30"></a>    }</span>
<span id="cb283-31"><a href="database-interaction.html#cb283-31"></a></span>
<span id="cb283-32"><a href="database-interaction.html#cb283-32"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setRole</span>(<span class="bu">Role</span> role) {</span>
<span id="cb283-33"><a href="database-interaction.html#cb283-33"></a>        <span class="kw">this</span>.<span class="fu">role</span> = role;</span>
<span id="cb283-34"><a href="database-interaction.html#cb283-34"></a>    }</span>
<span id="cb283-35"><a href="database-interaction.html#cb283-35"></a></span>
<span id="cb283-36"><a href="database-interaction.html#cb283-36"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span>() {</span>
<span id="cb283-37"><a href="database-interaction.html#cb283-37"></a>        <span class="kw">return</span> name;</span>
<span id="cb283-38"><a href="database-interaction.html#cb283-38"></a>    }</span>
<span id="cb283-39"><a href="database-interaction.html#cb283-39"></a></span>
<span id="cb283-40"><a href="database-interaction.html#cb283-40"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getEmail</span>() {</span>
<span id="cb283-41"><a href="database-interaction.html#cb283-41"></a>        <span class="kw">return</span> email;</span>
<span id="cb283-42"><a href="database-interaction.html#cb283-42"></a>    }</span>
<span id="cb283-43"><a href="database-interaction.html#cb283-43"></a></span>
<span id="cb283-44"><a href="database-interaction.html#cb283-44"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getPassword</span>() {</span>
<span id="cb283-45"><a href="database-interaction.html#cb283-45"></a>        <span class="kw">return</span> password;</span>
<span id="cb283-46"><a href="database-interaction.html#cb283-46"></a>    }</span>
<span id="cb283-47"><a href="database-interaction.html#cb283-47"></a></span>
<span id="cb283-48"><a href="database-interaction.html#cb283-48"></a>    <span class="kw">public</span> <span class="bu">Role</span> <span class="fu">getRole</span>() {</span>
<span id="cb283-49"><a href="database-interaction.html#cb283-49"></a>        <span class="kw">return</span> role;</span>
<span id="cb283-50"><a href="database-interaction.html#cb283-50"></a>    }</span>
<span id="cb283-51"><a href="database-interaction.html#cb283-51"></a>    <span class="co">//toString(), equals(), hashCode() and getSome() omitted</span></span>
<span id="cb283-52"><a href="database-interaction.html#cb283-52"></a>}</span></code></pre></div>
<p>The enum <code>Role</code>, modelling the role that website users can have:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb284-1"><a href="database-interaction.html#cb284-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model;</span></span>
<span id="cb284-2"><a href="database-interaction.html#cb284-2"></a></span>
<span id="cb284-3"><a href="database-interaction.html#cb284-3"></a><span class="kw">public</span> <span class="kw">enum</span> <span class="bu">Role</span> {</span>
<span id="cb284-4"><a href="database-interaction.html#cb284-4"></a>    GUEST,</span>
<span id="cb284-5"><a href="database-interaction.html#cb284-5"></a>    USER,</span>
<span id="cb284-6"><a href="database-interaction.html#cb284-6"></a>    ADMIN;</span>
<span id="cb284-7"><a href="database-interaction.html#cb284-7"></a>}</span></code></pre></div>
<p>and my custom Exception type that encapsulates all exceptions that can occur during database interaction:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb285-1"><a href="database-interaction.html#cb285-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.dao;</span></span>
<span id="cb285-2"><a href="database-interaction.html#cb285-2"></a></span>
<span id="cb285-3"><a href="database-interaction.html#cb285-3"></a><span class="kw">public</span> <span class="kw">class</span> DatabaseException <span class="kw">extends</span> <span class="bu">Exception</span> {</span>
<span id="cb285-4"><a href="database-interaction.html#cb285-4"></a>    <span class="kw">public</span> <span class="fu">DatabaseException</span>() {</span>
<span id="cb285-5"><a href="database-interaction.html#cb285-5"></a>        <span class="kw">super</span>();</span>
<span id="cb285-6"><a href="database-interaction.html#cb285-6"></a>    }</span>
<span id="cb285-7"><a href="database-interaction.html#cb285-7"></a></span>
<span id="cb285-8"><a href="database-interaction.html#cb285-8"></a>    <span class="kw">public</span> <span class="fu">DatabaseException</span>(<span class="bu">String</span> message) {</span>
<span id="cb285-9"><a href="database-interaction.html#cb285-9"></a>        <span class="kw">super</span>(message);</span>
<span id="cb285-10"><a href="database-interaction.html#cb285-10"></a>    }</span>
<span id="cb285-11"><a href="database-interaction.html#cb285-11"></a></span>
<span id="cb285-12"><a href="database-interaction.html#cb285-12"></a>    <span class="kw">public</span> <span class="fu">DatabaseException</span>(<span class="bu">String</span> message, <span class="bu">Throwable</span> cause) {</span>
<span id="cb285-13"><a href="database-interaction.html#cb285-13"></a>        <span class="kw">super</span>(message, cause);</span>
<span id="cb285-14"><a href="database-interaction.html#cb285-14"></a>    }</span>
<span id="cb285-15"><a href="database-interaction.html#cb285-15"></a></span>
<span id="cb285-16"><a href="database-interaction.html#cb285-16"></a>    <span class="kw">public</span> <span class="fu">DatabaseException</span>(<span class="bu">Throwable</span> cause) {</span>
<span id="cb285-17"><a href="database-interaction.html#cb285-17"></a>        <span class="kw">super</span>(cause);</span>
<span id="cb285-18"><a href="database-interaction.html#cb285-18"></a>    }</span>
<span id="cb285-19"><a href="database-interaction.html#cb285-19"></a></span>
<span id="cb285-20"><a href="database-interaction.html#cb285-20"></a>    <span class="kw">protected</span> <span class="fu">DatabaseException</span>(<span class="bu">String</span> message, <span class="bu">Throwable</span> cause, <span class="dt">boolean</span> enableSuppression, <span class="dt">boolean</span> writableStackTrace) {</span>
<span id="cb285-21"><a href="database-interaction.html#cb285-21"></a>        <span class="kw">super</span>(message, cause, enableSuppression, writableStackTrace);</span>
<span id="cb285-22"><a href="database-interaction.html#cb285-22"></a>    }</span>
<span id="cb285-23"><a href="database-interaction.html#cb285-23"></a>}</span></code></pre></div>
</div>
<div id="database-actions-within-intellij" class="section level4 unnumbered">
<h4>Database actions within IntelliJ</h4>
<p>IntelliJ has excellent support for databases: it has an internal MySQL console, and supports autocomplete on in-code SQL statements and sql scripts.</p>
<p>To get this Database toolbox support active, you need let IntelliJ know about the database and follow these steps:</p>
<ul>
<li>View → Tool Windows → Database</li>
<li>Click “+” → Data Source → MySQL</li>
</ul>
<div class="figure">
<img src="05_web/figures/add_datasource1.png" alt="" />
<p class="caption">Add datasource 1</p>
</div>
<ul>
<li>Fill in the blanks (note: you may <strong>not</strong> have a localhost MySQL server. Instead, it may run on some specific URL such as <code>mysql.bin</code>)</li>
</ul>
<div class="figure">
<img src="05_web/figures/add_datasource2.png" alt="" />
<p class="caption">Add datasource 2</p>
</div>
<ul>
<li>Click “download missing driver files”</li>
<li>Click “test connection”</li>
</ul>
<p>Note the URL it creates. Check that the data provided corresponds with your situation (Host, Database, User and Password).</p>
<ul>
<li>Open the MySQL console (double-click the data source in the Databases panel),</li>
<li>Enter a command</li>
<li>Press <code>Ctrl + enter</code></li>
</ul>
<div class="figure">
<img src="05_web/figures/add_datasource3.png" alt="" />
<p class="caption">Add datasource 3</p>
</div>
</div>
<div id="add-data-to-the-db" class="section level4 unnumbered">
<h4>Add data to the DB</h4>
<p>First, a simple table is defined and created, and some preliminary dummy data is entered.</p>
<pre class="mysql"><code>DROP TABLE IF EXISTS Users;
CREATE TABLE Users (
    user_id INT NOT NULL auto_increment,
    user_name VARCHAR(100) NOT NULL,
    user_password VARCHAR(100) NOT NULL,
    user_email VARCHAR(255) NOT NULL,
    user_role VARCHAR(100) NOT NULL,
    primary key(user_id));
    
INSERT INTO Users (user_name, user_password, user_email, user_role)
VALUES (&#39;Henk&#39;, &#39;Henkie&#39;, &#39;Henk@example.com&#39;, &#39;ADMIN&#39;);</code></pre>
<p>Of course, <strong><em>storing a user password unencrypted is a very bad idea</em></strong>. We will address this aspect later.</p>
<p>Next, have a look at the DB tool window:</p>
<div class="figure">
<img src="05_web/figures/add_datasource4.png" alt="" />
<p class="caption">Add datasource 4</p>
</div>
</div>
</div>
<div id="the-naive-implementation" class="section level2">
<h2><span class="header-section-number">36.2</span> The naive implementation</h2>
<p>Here follow some classes demonstrating the general usage of database interaction components.
You should not implement your logic like this - it is inefficient, not OO, and very ugly.
A better solution follows later in this chapter.
Study this class carefully so you understand how everything works at the syntax level.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb287-1"><a href="database-interaction.html#cb287-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.dao;</span></span>
<span id="cb287-2"><a href="database-interaction.html#cb287-2"></a></span>
<span id="cb287-3"><a href="database-interaction.html#cb287-3"></a><span class="kw">import</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model.Role;</span></span>
<span id="cb287-4"><a href="database-interaction.html#cb287-4"></a><span class="kw">import</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model.User;</span></span>
<span id="cb287-5"><a href="database-interaction.html#cb287-5"></a></span>
<span id="cb287-6"><a href="database-interaction.html#cb287-6"></a><span class="kw">import</span><span class="im"> java.sql.*;</span></span>
<span id="cb287-7"><a href="database-interaction.html#cb287-7"></a></span>
<span id="cb287-8"><a href="database-interaction.html#cb287-8"></a><span class="kw">public</span> <span class="kw">class</span> VerySimpleDbConnector {</span>
<span id="cb287-9"><a href="database-interaction.html#cb287-9"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> url;</span>
<span id="cb287-10"><a href="database-interaction.html#cb287-10"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> dbUser;</span>
<span id="cb287-11"><a href="database-interaction.html#cb287-11"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> dbPassword;</span>
<span id="cb287-12"><a href="database-interaction.html#cb287-12"></a>    <span class="kw">private</span> <span class="bu">Connection</span> connection;</span>
<span id="cb287-13"><a href="database-interaction.html#cb287-13"></a>    </span>
<span id="cb287-14"><a href="database-interaction.html#cb287-14"></a>    <span class="co">/**</span></span>
<span id="cb287-15"><a href="database-interaction.html#cb287-15"></a>     <span class="co">*</span> a main for demonstration purposes</span>
<span id="cb287-16"><a href="database-interaction.html#cb287-16"></a>     <span class="co">* </span><span class="an">@param args</span></span>
<span id="cb287-17"><a href="database-interaction.html#cb287-17"></a>     <span class="co">*/</span></span>
<span id="cb287-18"><a href="database-interaction.html#cb287-18"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</span>
<span id="cb287-19"><a href="database-interaction.html#cb287-19"></a>        <span class="kw">try</span> {</span>
<span id="cb287-20"><a href="database-interaction.html#cb287-20"></a>            <span class="co">//connect</span></span>
<span id="cb287-21"><a href="database-interaction.html#cb287-21"></a>            VerySimpleDbConnector connector = <span class="kw">new</span> <span class="fu">VerySimpleDbConnector</span>(<span class="st">&quot;&lt;host&gt;&quot;</span>, <span class="st">&quot;&lt;db-user&gt;&quot;</span>, <span class="st">&quot;db-password&quot;</span>);</span>
<span id="cb287-22"><a href="database-interaction.html#cb287-22"></a></span>
<span id="cb287-23"><a href="database-interaction.html#cb287-23"></a>            <span class="co">//insert a user</span></span>
<span id="cb287-24"><a href="database-interaction.html#cb287-24"></a>            connector.<span class="fu">insertUser</span>(<span class="st">&quot;Piet&quot;</span>, <span class="st">&quot;Pietissafe&quot;</span>, <span class="st">&quot;piet@example.com&quot;</span>, <span class="bu">Role</span>.<span class="fu">ADMIN</span>);</span>
<span id="cb287-25"><a href="database-interaction.html#cb287-25"></a></span>
<span id="cb287-26"><a href="database-interaction.html#cb287-26"></a>            <span class="co">//fetch a user</span></span>
<span id="cb287-27"><a href="database-interaction.html#cb287-27"></a>            connector.<span class="fu">getUser</span>(<span class="st">&quot;Piet&quot;</span>, <span class="st">&quot;Pietissafe&quot;</span>);</span>
<span id="cb287-28"><a href="database-interaction.html#cb287-28"></a></span>
<span id="cb287-29"><a href="database-interaction.html#cb287-29"></a>            <span class="co">//a catch-all for database interaction exceptions</span></span>
<span id="cb287-30"><a href="database-interaction.html#cb287-30"></a>        } <span class="kw">catch</span> (DatabaseException e) {</span>
<span id="cb287-31"><a href="database-interaction.html#cb287-31"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb287-32"><a href="database-interaction.html#cb287-32"></a>        }</span>
<span id="cb287-33"><a href="database-interaction.html#cb287-33"></a>    }</span>
<span id="cb287-34"><a href="database-interaction.html#cb287-34"></a></span>
<span id="cb287-35"><a href="database-interaction.html#cb287-35"></a>    <span class="kw">public</span> <span class="fu">VerySimpleDbConnector</span>(<span class="bu">String</span> url, <span class="bu">String</span> dbUser, <span class="bu">String</span> dbPassword) <span class="kw">throws</span> DatabaseException {</span>
<span id="cb287-36"><a href="database-interaction.html#cb287-36"></a>        <span class="kw">this</span>.<span class="fu">url</span> = url;</span>
<span id="cb287-37"><a href="database-interaction.html#cb287-37"></a>        <span class="kw">this</span>.<span class="fu">dbUser</span> = dbUser;</span>
<span id="cb287-38"><a href="database-interaction.html#cb287-38"></a>        <span class="kw">this</span>.<span class="fu">dbPassword</span> = dbPassword;</span>
<span id="cb287-39"><a href="database-interaction.html#cb287-39"></a></span>
<span id="cb287-40"><a href="database-interaction.html#cb287-40"></a>        <span class="co">//make the connection</span></span>
<span id="cb287-41"><a href="database-interaction.html#cb287-41"></a>        <span class="fu">connect</span>();</span>
<span id="cb287-42"><a href="database-interaction.html#cb287-42"></a>    }</span>
<span id="cb287-43"><a href="database-interaction.html#cb287-43"></a></span>
<span id="cb287-44"><a href="database-interaction.html#cb287-44"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">connect</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb287-45"><a href="database-interaction.html#cb287-45"></a>        <span class="kw">try</span> {</span>
<span id="cb287-46"><a href="database-interaction.html#cb287-46"></a>            <span class="co">//load driver class</span></span>
<span id="cb287-47"><a href="database-interaction.html#cb287-47"></a>            <span class="bu">Class</span>.<span class="fu">forName</span>(<span class="st">&quot;com.mysql.jdbc.Driver&quot;</span>);</span>
<span id="cb287-48"><a href="database-interaction.html#cb287-48"></a>            <span class="co">//create connection</span></span>
<span id="cb287-49"><a href="database-interaction.html#cb287-49"></a>            connection = <span class="bu">DriverManager</span>.<span class="fu">getConnection</span>(url, dbUser, dbPassword);</span>
<span id="cb287-50"><a href="database-interaction.html#cb287-50"></a>            <span class="co">//..which is risky</span></span>
<span id="cb287-51"><a href="database-interaction.html#cb287-51"></a>        } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {</span>
<span id="cb287-52"><a href="database-interaction.html#cb287-52"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb287-53"><a href="database-interaction.html#cb287-53"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb287-54"><a href="database-interaction.html#cb287-54"></a>                    e.<span class="fu">getCause</span>());</span>
<span id="cb287-55"><a href="database-interaction.html#cb287-55"></a>        }</span>
<span id="cb287-56"><a href="database-interaction.html#cb287-56"></a>    }</span>
<span id="cb287-57"><a href="database-interaction.html#cb287-57"></a></span>
<span id="cb287-58"><a href="database-interaction.html#cb287-58"></a>    <span class="kw">public</span> User <span class="fu">getUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass) <span class="kw">throws</span> DatabaseException  {</span>
<span id="cb287-59"><a href="database-interaction.html#cb287-59"></a>        <span class="kw">try</span> {</span>
<span id="cb287-60"><a href="database-interaction.html#cb287-60"></a>            <span class="co">//Prepare the SQL statement. The question marks are placeholders for repeated use with different data</span></span>
<span id="cb287-61"><a href="database-interaction.html#cb287-61"></a>            <span class="co">//!! Doing this within this method is extremely inefficient !!</span></span>
<span id="cb287-62"><a href="database-interaction.html#cb287-62"></a>            <span class="bu">String</span> fetchQuery = <span class="st">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span>;</span>
<span id="cb287-63"><a href="database-interaction.html#cb287-63"></a>            <span class="bu">PreparedStatement</span> ps = connection.<span class="fu">prepareStatement</span>(fetchQuery);</span>
<span id="cb287-64"><a href="database-interaction.html#cb287-64"></a></span>
<span id="cb287-65"><a href="database-interaction.html#cb287-65"></a>            <span class="co">//set data on the &quot;?&quot; placeholders of the prepared statement</span></span>
<span id="cb287-66"><a href="database-interaction.html#cb287-66"></a>            ps.<span class="fu">setString</span>(<span class="dv">1</span>, userName);</span>
<span id="cb287-67"><a href="database-interaction.html#cb287-67"></a>            ps.<span class="fu">setString</span>(<span class="dv">2</span>, userPass);</span>
<span id="cb287-68"><a href="database-interaction.html#cb287-68"></a></span>
<span id="cb287-69"><a href="database-interaction.html#cb287-69"></a>            <span class="co">//execute</span></span>
<span id="cb287-70"><a href="database-interaction.html#cb287-70"></a>            <span class="bu">ResultSet</span> rs = ps.<span class="fu">executeQuery</span>();</span>
<span id="cb287-71"><a href="database-interaction.html#cb287-71"></a></span>
<span id="cb287-72"><a href="database-interaction.html#cb287-72"></a>            <span class="co">//if there is data, process it</span></span>
<span id="cb287-73"><a href="database-interaction.html#cb287-73"></a>            <span class="kw">while</span> (rs.<span class="fu">next</span>()) {</span>
<span id="cb287-74"><a href="database-interaction.html#cb287-74"></a>                <span class="bu">String</span> userMail = rs.<span class="fu">getString</span>(<span class="st">&quot;user_email&quot;</span>);</span>
<span id="cb287-75"><a href="database-interaction.html#cb287-75"></a>                <span class="bu">String</span> userIdStr = rs.<span class="fu">getString</span>(<span class="st">&quot;user_id&quot;</span>);</span>
<span id="cb287-76"><a href="database-interaction.html#cb287-76"></a>                <span class="bu">String</span> userRoleStr = rs.<span class="fu">getString</span>(<span class="st">&quot;user_role&quot;</span>);</span>
<span id="cb287-77"><a href="database-interaction.html#cb287-77"></a>                <span class="bu">Role</span> role = <span class="bu">Role</span>.<span class="fu">valueOf</span>(userRoleStr);</span>
<span id="cb287-78"><a href="database-interaction.html#cb287-78"></a>                User user = <span class="kw">new</span> <span class="fu">User</span>(userName, userMail, userPass, role);</span>
<span id="cb287-79"><a href="database-interaction.html#cb287-79"></a>                <span class="kw">return</span> user;</span>
<span id="cb287-80"><a href="database-interaction.html#cb287-80"></a>            }</span>
<span id="cb287-81"><a href="database-interaction.html#cb287-81"></a></span>
<span id="cb287-82"><a href="database-interaction.html#cb287-82"></a>            <span class="co">//close resources</span></span>
<span id="cb287-83"><a href="database-interaction.html#cb287-83"></a>            rs.<span class="fu">close</span>();</span>
<span id="cb287-84"><a href="database-interaction.html#cb287-84"></a>        } <span class="kw">catch</span> (<span class="bu">SQLException</span> e) {</span>
<span id="cb287-85"><a href="database-interaction.html#cb287-85"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb287-86"><a href="database-interaction.html#cb287-86"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb287-87"><a href="database-interaction.html#cb287-87"></a>                    e.<span class="fu">getCause</span>());</span>
<span id="cb287-88"><a href="database-interaction.html#cb287-88"></a>        }</span>
<span id="cb287-89"><a href="database-interaction.html#cb287-89"></a>        <span class="kw">return</span> <span class="kw">null</span>;</span>
<span id="cb287-90"><a href="database-interaction.html#cb287-90"></a>    }</span>
<span id="cb287-91"><a href="database-interaction.html#cb287-91"></a></span>
<span id="cb287-92"><a href="database-interaction.html#cb287-92"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">insertUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass, <span class="bu">String</span> email, <span class="bu">Role</span> role) <span class="kw">throws</span> DatabaseException  {</span>
<span id="cb287-93"><a href="database-interaction.html#cb287-93"></a>        <span class="kw">try</span>{</span>
<span id="cb287-94"><a href="database-interaction.html#cb287-94"></a>            <span class="co">//Prepare statement</span></span>
<span id="cb287-95"><a href="database-interaction.html#cb287-95"></a>            <span class="co">//!! Doing this within this method is extremely inefficient !!</span></span>
<span id="cb287-96"><a href="database-interaction.html#cb287-96"></a>            <span class="bu">String</span> insertQuery = <span class="st">&quot;INSERT INTO Users (user_name, user_password, user_email, user_role) &quot;</span></span>
<span id="cb287-97"><a href="database-interaction.html#cb287-97"></a>                    + <span class="st">&quot; VALUES (?, ?, ?, ?)&quot;</span>;</span>
<span id="cb287-98"><a href="database-interaction.html#cb287-98"></a>            <span class="bu">PreparedStatement</span> ps = connection.<span class="fu">prepareStatement</span>(insertQuery);</span>
<span id="cb287-99"><a href="database-interaction.html#cb287-99"></a></span>
<span id="cb287-100"><a href="database-interaction.html#cb287-100"></a>            <span class="co">//set data on the &quot;?&quot; placeholders of the prepared statement</span></span>
<span id="cb287-101"><a href="database-interaction.html#cb287-101"></a>            ps.<span class="fu">setString</span>(<span class="dv">1</span>, userName);</span>
<span id="cb287-102"><a href="database-interaction.html#cb287-102"></a>            ps.<span class="fu">setString</span>(<span class="dv">2</span>, userPass);</span>
<span id="cb287-103"><a href="database-interaction.html#cb287-103"></a>            ps.<span class="fu">setString</span>(<span class="dv">3</span>, email);</span>
<span id="cb287-104"><a href="database-interaction.html#cb287-104"></a>            ps.<span class="fu">setString</span>(<span class="dv">4</span>, role.<span class="fu">toString</span>());</span>
<span id="cb287-105"><a href="database-interaction.html#cb287-105"></a></span>
<span id="cb287-106"><a href="database-interaction.html#cb287-106"></a>            <span class="co">//do the actual insert</span></span>
<span id="cb287-107"><a href="database-interaction.html#cb287-107"></a>            ps.<span class="fu">executeUpdate</span>();</span>
<span id="cb287-108"><a href="database-interaction.html#cb287-108"></a></span>
<span id="cb287-109"><a href="database-interaction.html#cb287-109"></a>            <span class="co">//close resources</span></span>
<span id="cb287-110"><a href="database-interaction.html#cb287-110"></a>            ps.<span class="fu">close</span>();</span>
<span id="cb287-111"><a href="database-interaction.html#cb287-111"></a>        } <span class="kw">catch</span> (<span class="bu">Exception</span> ex) {</span>
<span id="cb287-112"><a href="database-interaction.html#cb287-112"></a>            ex.<span class="fu">printStackTrace</span>();</span>
<span id="cb287-113"><a href="database-interaction.html#cb287-113"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb287-114"><a href="database-interaction.html#cb287-114"></a>                    ex.<span class="fu">getCause</span>());</span>
<span id="cb287-115"><a href="database-interaction.html#cb287-115"></a>        }</span>
<span id="cb287-116"><a href="database-interaction.html#cb287-116"></a>    }</span>
<span id="cb287-117"><a href="database-interaction.html#cb287-117"></a></span>
<span id="cb287-118"><a href="database-interaction.html#cb287-118"></a>    <span class="co">/**</span></span>
<span id="cb287-119"><a href="database-interaction.html#cb287-119"></a>     <span class="co">*</span> close the connection<span class="co">!</span></span>
<span id="cb287-120"><a href="database-interaction.html#cb287-120"></a>     <span class="co">*</span> <span class="an">@throws DatabaseException</span></span>
<span id="cb287-121"><a href="database-interaction.html#cb287-121"></a>     <span class="co">*/</span></span>
<span id="cb287-122"><a href="database-interaction.html#cb287-122"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">disconnect</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb287-123"><a href="database-interaction.html#cb287-123"></a>        <span class="kw">try</span> {</span>
<span id="cb287-124"><a href="database-interaction.html#cb287-124"></a>            connection.<span class="fu">close</span>();</span>
<span id="cb287-125"><a href="database-interaction.html#cb287-125"></a>        } <span class="kw">catch</span> (<span class="bu">SQLException</span> e) {</span>
<span id="cb287-126"><a href="database-interaction.html#cb287-126"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb287-127"><a href="database-interaction.html#cb287-127"></a>        }</span>
<span id="cb287-128"><a href="database-interaction.html#cb287-128"></a>    }</span>
<span id="cb287-129"><a href="database-interaction.html#cb287-129"></a>}</span></code></pre></div>
<div id="jdbc-class-loading" class="section level4 unnumbered">
<h4>JDBC class loading</h4>
<div class="sourceCode" id="cb288"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb288-1"><a href="database-interaction.html#cb288-1"></a>    <span class="bu">Class</span>.<span class="fu">forName</span>(<span class="st">&quot;com.mysql.jdbc.Driver&quot;</span>);</span></code></pre></div>
<p>This mechanism is called <strong><em>dynamic class loading</em></strong>. It loads the driver classes required for the MySQL interaction:</p>
</div>
<div id="create-a-connection" class="section level4 unnumbered">
<h4>Create a Connection</h4>
<p>After loading the driver class(es), you need to establish a connection:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb289-1"><a href="database-interaction.html#cb289-1"></a>    <span class="bu">String</span> dbUrl = <span class="st">&quot;jdbc:mysql://MyHost/MyDbName&quot;</span>;</span>
<span id="cb289-2"><a href="database-interaction.html#cb289-2"></a>    <span class="bu">String</span> dbUser = <span class="st">&quot;Fred&quot;</span>;</span>
<span id="cb289-3"><a href="database-interaction.html#cb289-3"></a>    <span class="bu">String</span> dbPass = <span class="st">&quot;FredIsSafe&quot;</span>;</span>
<span id="cb289-4"><a href="database-interaction.html#cb289-4"></a>    <span class="kw">this</span>.<span class="fu">connection</span> = <span class="bu">DriverManager</span>.<span class="fu">getConnection</span>(dbUrl, dbUser, dbPass);</span></code></pre></div>
<p>Note that hardcoding your passwords in a repo that you are going to put online is a very bad idea; see the next section ofr a solution.</p>
</div>
</div>
<div id="improve-on-naive-implementation" class="section level2">
<h2><span class="header-section-number">36.3</span> Improve on naive implementation</h2>
<div id="externalize-your-credentials" class="section level4 unnumbered">
<h4>Externalize your credentials</h4>
<p>I have created a small helper app that you can use to prevent storing passwords in your code. It reads your credentials from the <code>.my.cnf</code> file stored in your home folder.</p>
<p>You can clone and build the <a href="https://bitbucket.org/michiel_noback/dbutils">repo</a>
or download the jar <a href="../downloads/DButils-1.0.2.jar">here</a> and put it in your build path by adding the following line to the <code>build/gradle</code> file:</p>
<pre class="gradle"><code>compile files(&#39;path/to/library/folder/DButils-1.0.2.jar&#39;)</code></pre>
<p>When you have it on the build path, simply use it as follows:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb291-1"><a href="database-interaction.html#cb291-1"></a>DbUser dbUser = DbCredentials.<span class="fu">getMySQLuser</span>();</span>
<span id="cb291-2"><a href="database-interaction.html#cb291-2"></a><span class="bu">String</span> user = dbUser.<span class="fu">getUserName</span>();</span>
<span id="cb291-3"><a href="database-interaction.html#cb291-3"></a><span class="bu">String</span> passWrd = dbUser.<span class="fu">getDatabasePassword</span>();</span>
<span id="cb291-4"><a href="database-interaction.html#cb291-4"></a><span class="bu">String</span> host = dbUser.<span class="fu">getHost</span>();</span>
<span id="cb291-5"><a href="database-interaction.html#cb291-5"></a><span class="bu">String</span> dbName = dbUser.<span class="fu">getDatabaseName</span>();</span></code></pre></div>
<p>assuming you have a <code>.my.cnf</code> file in your home folder and it has the correct entries:</p>
<pre class="conf"><code>[client]
user=&lt;db user name&gt;
password=&lt;db password&gt;
host=localhost
database=&lt;default database&gt;</code></pre>
<p>Once you establish the connection, you have a live <code>java.sql.Connection</code> object.
Talking to a database -an external resource- is “risky” business, so you have to put it in a try/catch block.
In a real app, you should do something else with the exception than print it of course, but this post is not about exception handling.</p>
</div>
<div id="use-preparedstatements" class="section level4 unnumbered">
<h4>Use PreparedStatements</h4>
<p>Use PreparedStatements for interacting with the database.
Using <code>PreparedStatement</code> instances makes it easier and far more efficient to repeat a query. Here is one of the two queries that are required for implementing the interface methods.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb293-1"><a href="database-interaction.html#cb293-1"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> GET_USER = <span class="st">&quot;get_user&quot;</span>;</span>
<span id="cb293-2"><a href="database-interaction.html#cb293-2"></a></span>
<span id="cb293-3"><a href="database-interaction.html#cb293-3"></a>    <span class="co">/**</span></span>
<span id="cb293-4"><a href="database-interaction.html#cb293-4"></a>     <span class="co">*</span> prepares prepared statements for reuse</span>
<span id="cb293-5"><a href="database-interaction.html#cb293-5"></a>     <span class="co">* </span><span class="an">@throws SQLException</span></span>
<span id="cb293-6"><a href="database-interaction.html#cb293-6"></a>     <span class="co">*/</span></span>
<span id="cb293-7"><a href="database-interaction.html#cb293-7"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">prepareStatements</span>() <span class="kw">throws</span> <span class="bu">SQLException</span> {</span>
<span id="cb293-8"><a href="database-interaction.html#cb293-8"></a>        <span class="bu">String</span> fetchQuery = <span class="st">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span>;</span>
<span id="cb293-9"><a href="database-interaction.html#cb293-9"></a>        <span class="bu">PreparedStatement</span> ps = connection.<span class="fu">prepareStatement</span>(fetchQuery);</span>
<span id="cb293-10"><a href="database-interaction.html#cb293-10"></a>        <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">put</span>(GET_USER, ps);</span>
<span id="cb293-11"><a href="database-interaction.html#cb293-11"></a>    }</span></code></pre></div>
<p>The prepared statements are stored as entries of a Map, which is an instance variable of the class <code>MyAppDaoMySQL. The</code>?` characters serve as placeholders, to be replaced with actual values before executing the statement. See next section.</p>
</div>
<div id="traversing-results" class="section level4 unnumbered">
<h4>Traversing results</h4>
<p>Results can be traversed through the <code>ResultSet</code> object that you get back from <code>ResultSet rs = ps.executeQuery();</code>.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb294-1"><a href="database-interaction.html#cb294-1"></a>    <span class="bu">ResultSet</span> rs = ps.<span class="fu">executeQuery</span>();</span>
<span id="cb294-2"><a href="database-interaction.html#cb294-2"></a>    <span class="kw">while</span> (rs.<span class="fu">next</span>()) {</span>
<span id="cb294-3"><a href="database-interaction.html#cb294-3"></a>        <span class="co">//process results</span></span>
<span id="cb294-4"><a href="database-interaction.html#cb294-4"></a>    }</span></code></pre></div>
<p>Here, you see the use of <code>while (rs.next()) {}</code> which is not entirely logical if you expect a single result, as in this case (checking for a registered user). Maybe it is better to add some checks, such as:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb295-1"><a href="database-interaction.html#cb295-1"></a><span class="kw">if</span> (rs.<span class="fu">getFetchSize</span>() &gt; <span class="dv">1</span>) {</span>
<span id="cb295-2"><a href="database-interaction.html#cb295-2"></a>    <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;something wrong&quot;</span>);</span>
<span id="cb295-3"><a href="database-interaction.html#cb295-3"></a>}</span></code></pre></div>
<p>Now the low level code details are ready and known, let’s implement this in a better way.</p>
</div>
<div id="code-against-interfaces" class="section level3">
<h3><span class="header-section-number">36.3.1</span> Code against interfaces</h3>
<p>Code against interfaces, not implementations.</p>
<p>Suppose you start working on a website with a MySQL database as backend data layer. You think “encapsulation”, and create a class responsible for all database interaction (<code>MyMySqlDbConnector</code>), and use this class all over our code base. Something like this:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb296-1"><a href="database-interaction.html#cb296-1"></a>MyMySqlDbConnector dbConnector = <span class="kw">new</span> <span class="fu">MyMySqlDbConnector</span>(url, user, pass);</span></code></pre></div>
<p>Next year, after our application has grown, we decide a <strong><em>key-value store</em></strong> such as Couchbase is better suited for our growing customer base. We create a new class, <code>MyCouchbaseConnector</code>. Unfortunately, everywhere we used the MySQL connector, we need to change our code to the new implementation.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb297-1"><a href="database-interaction.html#cb297-1"></a>MyCouchbaseConnector dbConnector = <span class="kw">new</span> <span class="fu">MyCouchbaseConnector</span>();</span></code></pre></div>
<p>And if we are unlucky, the <code>MyCouchbaseConnector</code> has differing method signatures as well, making the refactoring process a hellish job.</p>
<p>That is such an unnecessary waste of time if we would have adhered to one of the prime directives of OO programming: <strong>Code against interfaces not implementations</strong> (where interface may mean interface as type, but also abstract class).</p>
</div>
</div>
<div id="refactoring-to-oo-principles" class="section level2">
<h2><span class="header-section-number">36.4</span> Refactoring to OO principles</h2>
<p>This principle is outlined in the following series of steps.</p>
<div id="an-interface-definition" class="section level4 unnumbered">
<h4>1: An interface definition</h4>
<p>Think long and hard about the contract: which methods do you need, disregarding the technology behind the scenes?
This will be your interface definition.
Here is the interface specifying my user database interactions:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb298-1"><a href="database-interaction.html#cb298-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.dao;</span></span>
<span id="cb298-2"><a href="database-interaction.html#cb298-2"></a></span>
<span id="cb298-3"><a href="database-interaction.html#cb298-3"></a><span class="kw">import</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model.Role;</span></span>
<span id="cb298-4"><a href="database-interaction.html#cb298-4"></a><span class="kw">import</span><span class="im"> nl.bioinf.wis_on_thymeleaf.model.User;</span></span>
<span id="cb298-5"><a href="database-interaction.html#cb298-5"></a></span>
<span id="cb298-6"><a href="database-interaction.html#cb298-6"></a><span class="kw">public</span> <span class="kw">interface</span> MyAppDao{</span>
<span id="cb298-7"><a href="database-interaction.html#cb298-7"></a></span>
<span id="cb298-8"><a href="database-interaction.html#cb298-8"></a>    <span class="co">/**</span></span>
<span id="cb298-9"><a href="database-interaction.html#cb298-9"></a>    <span class="co">*</span> connection logic should be put here<span class="co">.</span></span>
<span id="cb298-10"><a href="database-interaction.html#cb298-10"></a>    <span class="co">*</span> <span class="an">@throws DatabaseException</span></span>
<span id="cb298-11"><a href="database-interaction.html#cb298-11"></a>    <span class="co">*/</span></span>
<span id="cb298-12"><a href="database-interaction.html#cb298-12"></a>    <span class="dt">void</span> <span class="fu">connect</span>() <span class="kw">throws</span> DatabaseException;</span>
<span id="cb298-13"><a href="database-interaction.html#cb298-13"></a></span>
<span id="cb298-14"><a href="database-interaction.html#cb298-14"></a>    <span class="co">/**</span></span>
<span id="cb298-15"><a href="database-interaction.html#cb298-15"></a>    <span class="co">*</span> shutdown logic should be put here</span>
<span id="cb298-16"><a href="database-interaction.html#cb298-16"></a>    <span class="co">* </span><span class="an">@throws DatabaseException</span></span>
<span id="cb298-17"><a href="database-interaction.html#cb298-17"></a>    <span class="co">*/</span></span>
<span id="cb298-18"><a href="database-interaction.html#cb298-18"></a>    <span class="dt">void</span> <span class="fu">disconnect</span>() <span class="kw">throws</span> DatabaseException;</span>
<span id="cb298-19"><a href="database-interaction.html#cb298-19"></a></span>
<span id="cb298-20"><a href="database-interaction.html#cb298-20"></a>    <span class="co">/**</span></span>
<span id="cb298-21"><a href="database-interaction.html#cb298-21"></a>    <span class="co">*</span> fetches a user by username and password<span class="co">.</span></span>
<span id="cb298-22"><a href="database-interaction.html#cb298-22"></a>    <span class="co">*</span> <span class="an">@param userName</span></span>
<span id="cb298-23"><a href="database-interaction.html#cb298-23"></a>    <span class="co">*</span> <span class="an">@param userPass</span></span>
<span id="cb298-24"><a href="database-interaction.html#cb298-24"></a>    <span class="co">*</span> <span class="co">@</span>return</span>
<span id="cb298-25"><a href="database-interaction.html#cb298-25"></a>    <span class="co">*</span> <span class="an">@throws DatabaseException</span></span>
<span id="cb298-26"><a href="database-interaction.html#cb298-26"></a>    <span class="co">*/</span></span>
<span id="cb298-27"><a href="database-interaction.html#cb298-27"></a>    User <span class="fu">getUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass) <span class="kw">throws</span> DatabaseException;</span>
<span id="cb298-28"><a href="database-interaction.html#cb298-28"></a></span>
<span id="cb298-29"><a href="database-interaction.html#cb298-29"></a>    <span class="co">/**</span></span>
<span id="cb298-30"><a href="database-interaction.html#cb298-30"></a>    <span class="co">*</span> inserts a new User<span class="co">.</span></span>
<span id="cb298-31"><a href="database-interaction.html#cb298-31"></a>    <span class="co">*</span> <span class="an">@param userName</span></span>
<span id="cb298-32"><a href="database-interaction.html#cb298-32"></a>    <span class="co">*</span> <span class="an">@param userPass</span></span>
<span id="cb298-33"><a href="database-interaction.html#cb298-33"></a>    <span class="co">*</span> <span class="an">@param email</span></span>
<span id="cb298-34"><a href="database-interaction.html#cb298-34"></a>    <span class="co">*</span> <span class="an">@param role</span></span>
<span id="cb298-35"><a href="database-interaction.html#cb298-35"></a>    <span class="co">*</span> <span class="an">@throws DatabaseException</span></span>
<span id="cb298-36"><a href="database-interaction.html#cb298-36"></a>    <span class="co">*/</span></span>
<span id="cb298-37"><a href="database-interaction.html#cb298-37"></a>    <span class="dt">void</span> <span class="fu">insertUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass, <span class="bu">String</span> email, <span class="bu">Role</span> role) <span class="kw">throws</span> DatabaseException;</span>
<span id="cb298-38"><a href="database-interaction.html#cb298-38"></a>}</span></code></pre></div>
</div>
<div id="create-an-interface-implementer" class="section level4 unnumbered">
<h4>2: Create an interface implementer</h4>
<p>Here is the complete class. It of course implements all interface methods.
The Singleton pattern will be explained below.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb299-1"><a href="database-interaction.html#cb299-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.dao;</span></span>
<span id="cb299-2"><a href="database-interaction.html#cb299-2"></a><span class="co">//imports omitted</span></span>
<span id="cb299-3"><a href="database-interaction.html#cb299-3"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> MyAppDaoMySQL <span class="kw">implements</span> MyAppDao {</span>
<span id="cb299-4"><a href="database-interaction.html#cb299-4"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> GET_USER = <span class="st">&quot;get_user&quot;</span>;</span>
<span id="cb299-5"><a href="database-interaction.html#cb299-5"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> INSERT_USER = <span class="st">&quot;insert_user&quot;</span>;</span>
<span id="cb299-6"><a href="database-interaction.html#cb299-6"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> url;</span>
<span id="cb299-7"><a href="database-interaction.html#cb299-7"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> dbUser;</span>
<span id="cb299-8"><a href="database-interaction.html#cb299-8"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> dbPassword;</span>
<span id="cb299-9"><a href="database-interaction.html#cb299-9"></a>    <span class="kw">private</span> <span class="bu">Connection</span> connection;</span>
<span id="cb299-10"><a href="database-interaction.html#cb299-10"></a>    <span class="kw">private</span> <span class="bu">Map</span>&lt;<span class="bu">String</span>, <span class="bu">PreparedStatement</span>&gt; preparedStatements = <span class="kw">new</span> <span class="bu">HashMap</span>&lt;&gt;();</span>
<span id="cb299-11"><a href="database-interaction.html#cb299-11"></a></span>
<span id="cb299-12"><a href="database-interaction.html#cb299-12"></a>    <span class="co">/*singleton pattern*/</span></span>
<span id="cb299-13"><a href="database-interaction.html#cb299-13"></a>    <span class="kw">private</span> <span class="dt">static</span> MyAppDaoMySQL uniqueInstance;</span>
<span id="cb299-14"><a href="database-interaction.html#cb299-14"></a></span>
<span id="cb299-15"><a href="database-interaction.html#cb299-15"></a>    <span class="co">/**</span></span>
<span id="cb299-16"><a href="database-interaction.html#cb299-16"></a>     <span class="co">*</span> singleton pattern</span>
<span id="cb299-17"><a href="database-interaction.html#cb299-17"></a>     <span class="co">*/</span></span>
<span id="cb299-18"><a href="database-interaction.html#cb299-18"></a>    <span class="kw">private</span> <span class="fu">MyAppDaoMySQL</span>(<span class="bu">String</span> url, <span class="bu">String</span> dbUser, <span class="bu">String</span> dbPassword) {</span>
<span id="cb299-19"><a href="database-interaction.html#cb299-19"></a>        <span class="kw">this</span>.<span class="fu">url</span> = url;</span>
<span id="cb299-20"><a href="database-interaction.html#cb299-20"></a>        <span class="kw">this</span>.<span class="fu">dbUser</span> = dbUser;</span>
<span id="cb299-21"><a href="database-interaction.html#cb299-21"></a>        <span class="kw">this</span>.<span class="fu">dbPassword</span> = dbPassword;</span>
<span id="cb299-22"><a href="database-interaction.html#cb299-22"></a>    }</span>
<span id="cb299-23"><a href="database-interaction.html#cb299-23"></a></span>
<span id="cb299-24"><a href="database-interaction.html#cb299-24"></a>    <span class="co">/**</span></span>
<span id="cb299-25"><a href="database-interaction.html#cb299-25"></a>     <span class="co">*</span> singleton pattern</span>
<span id="cb299-26"><a href="database-interaction.html#cb299-26"></a>     <span class="co">*/</span></span>
<span id="cb299-27"><a href="database-interaction.html#cb299-27"></a>    <span class="kw">public</span> <span class="dt">static</span> MyAppDaoMySQL <span class="fu">getInstance</span>(<span class="bu">String</span> url, <span class="bu">String</span> dbUser, <span class="bu">String</span> dbPassword) {</span>
<span id="cb299-28"><a href="database-interaction.html#cb299-28"></a>        <span class="co">//lazy</span></span>
<span id="cb299-29"><a href="database-interaction.html#cb299-29"></a>        <span class="kw">if</span> (uniqueInstance == <span class="kw">null</span>) {</span>
<span id="cb299-30"><a href="database-interaction.html#cb299-30"></a>            uniqueInstance = <span class="kw">new</span> <span class="fu">MyAppDaoMySQL</span>(url, dbUser, dbPassword);</span>
<span id="cb299-31"><a href="database-interaction.html#cb299-31"></a>        }</span>
<span id="cb299-32"><a href="database-interaction.html#cb299-32"></a>        <span class="kw">return</span> uniqueInstance;</span>
<span id="cb299-33"><a href="database-interaction.html#cb299-33"></a>    }</span>
<span id="cb299-34"><a href="database-interaction.html#cb299-34"></a></span>
<span id="cb299-35"><a href="database-interaction.html#cb299-35"></a>    <span class="at">@Override</span></span>
<span id="cb299-36"><a href="database-interaction.html#cb299-36"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">connect</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb299-37"><a href="database-interaction.html#cb299-37"></a>        <span class="kw">try</span> {</span>
<span id="cb299-38"><a href="database-interaction.html#cb299-38"></a>            <span class="bu">Class</span>.<span class="fu">forName</span>(<span class="st">&quot;com.mysql.jdbc.Driver&quot;</span>);</span>
<span id="cb299-39"><a href="database-interaction.html#cb299-39"></a>            connection = <span class="bu">DriverManager</span>.<span class="fu">getConnection</span>(url, dbUser, dbPassword);</span>
<span id="cb299-40"><a href="database-interaction.html#cb299-40"></a>            <span class="fu">prepareStatements</span>();</span>
<span id="cb299-41"><a href="database-interaction.html#cb299-41"></a>        } <span class="kw">catch</span> (<span class="bu">Exception</span> e) {</span>
<span id="cb299-42"><a href="database-interaction.html#cb299-42"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb299-43"><a href="database-interaction.html#cb299-43"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb299-44"><a href="database-interaction.html#cb299-44"></a>                    e.<span class="fu">getCause</span>());</span>
<span id="cb299-45"><a href="database-interaction.html#cb299-45"></a>        }</span>
<span id="cb299-46"><a href="database-interaction.html#cb299-46"></a>    }</span>
<span id="cb299-47"><a href="database-interaction.html#cb299-47"></a></span>
<span id="cb299-48"><a href="database-interaction.html#cb299-48"></a>    <span class="co">/**</span></span>
<span id="cb299-49"><a href="database-interaction.html#cb299-49"></a>     <span class="co">*</span> prepares prepared statements for reuse</span>
<span id="cb299-50"><a href="database-interaction.html#cb299-50"></a>     <span class="co">* </span><span class="an">@throws SQLException</span></span>
<span id="cb299-51"><a href="database-interaction.html#cb299-51"></a>     <span class="co">*/</span></span>
<span id="cb299-52"><a href="database-interaction.html#cb299-52"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">prepareStatements</span>() <span class="kw">throws</span> <span class="bu">SQLException</span> {</span>
<span id="cb299-53"><a href="database-interaction.html#cb299-53"></a>        <span class="bu">String</span> fetchQuery = <span class="st">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span>;</span>
<span id="cb299-54"><a href="database-interaction.html#cb299-54"></a>        <span class="bu">PreparedStatement</span> ps = connection.<span class="fu">prepareStatement</span>(fetchQuery);</span>
<span id="cb299-55"><a href="database-interaction.html#cb299-55"></a>        <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">put</span>(GET_USER, ps);</span>
<span id="cb299-56"><a href="database-interaction.html#cb299-56"></a></span>
<span id="cb299-57"><a href="database-interaction.html#cb299-57"></a>        <span class="bu">String</span> insertQuery = <span class="st">&quot;INSERT INTO Users (user_name, user_password, user_email, user_role) &quot;</span></span>
<span id="cb299-58"><a href="database-interaction.html#cb299-58"></a>                        + <span class="st">&quot; VALUES (?, ?, ?, ?)&quot;</span>;</span>
<span id="cb299-59"><a href="database-interaction.html#cb299-59"></a>        ps = connection.<span class="fu">prepareStatement</span>(insertQuery);</span>
<span id="cb299-60"><a href="database-interaction.html#cb299-60"></a>        <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">put</span>(INSERT_USER, ps);</span>
<span id="cb299-61"><a href="database-interaction.html#cb299-61"></a>    }</span>
<span id="cb299-62"><a href="database-interaction.html#cb299-62"></a></span>
<span id="cb299-63"><a href="database-interaction.html#cb299-63"></a>    <span class="at">@Override</span></span>
<span id="cb299-64"><a href="database-interaction.html#cb299-64"></a>    <span class="kw">public</span> User <span class="fu">getUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass) <span class="kw">throws</span> DatabaseException  {</span>
<span id="cb299-65"><a href="database-interaction.html#cb299-65"></a>        <span class="kw">try</span> {</span>
<span id="cb299-66"><a href="database-interaction.html#cb299-66"></a>            <span class="bu">PreparedStatement</span> ps = <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">get</span>(GET_USER);</span>
<span id="cb299-67"><a href="database-interaction.html#cb299-67"></a>            ps.<span class="fu">setString</span>(<span class="dv">1</span>, userName);</span>
<span id="cb299-68"><a href="database-interaction.html#cb299-68"></a>            ps.<span class="fu">setString</span>(<span class="dv">2</span>, userPass);</span>
<span id="cb299-69"><a href="database-interaction.html#cb299-69"></a>            <span class="bu">ResultSet</span> rs = ps.<span class="fu">executeQuery</span>();</span>
<span id="cb299-70"><a href="database-interaction.html#cb299-70"></a>            <span class="kw">while</span> (rs.<span class="fu">next</span>()) {</span>
<span id="cb299-71"><a href="database-interaction.html#cb299-71"></a>                <span class="bu">String</span> userMail = rs.<span class="fu">getString</span>(<span class="st">&quot;user_email&quot;</span>);</span>
<span id="cb299-72"><a href="database-interaction.html#cb299-72"></a>                <span class="bu">String</span> userIdStr = rs.<span class="fu">getString</span>(<span class="st">&quot;user_id&quot;</span>);</span>
<span id="cb299-73"><a href="database-interaction.html#cb299-73"></a>                <span class="bu">String</span> userRoleStr = rs.<span class="fu">getString</span>(<span class="st">&quot;user_role&quot;</span>);</span>
<span id="cb299-74"><a href="database-interaction.html#cb299-74"></a>                <span class="bu">Role</span> role = <span class="bu">Role</span>.<span class="fu">valueOf</span>(userRoleStr);</span>
<span id="cb299-75"><a href="database-interaction.html#cb299-75"></a>                User user = <span class="kw">new</span> <span class="fu">User</span>(userName, userMail, userPass, role);</span>
<span id="cb299-76"><a href="database-interaction.html#cb299-76"></a>                <span class="kw">return</span> user;</span>
<span id="cb299-77"><a href="database-interaction.html#cb299-77"></a>            }</span>
<span id="cb299-78"><a href="database-interaction.html#cb299-78"></a>            rs.<span class="fu">close</span>();</span>
<span id="cb299-79"><a href="database-interaction.html#cb299-79"></a>        } <span class="kw">catch</span> (<span class="bu">SQLException</span> e) {</span>
<span id="cb299-80"><a href="database-interaction.html#cb299-80"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb299-81"><a href="database-interaction.html#cb299-81"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb299-82"><a href="database-interaction.html#cb299-82"></a>                    e.<span class="fu">getCause</span>());</span>
<span id="cb299-83"><a href="database-interaction.html#cb299-83"></a>        }</span>
<span id="cb299-84"><a href="database-interaction.html#cb299-84"></a>        <span class="kw">return</span> <span class="kw">null</span>;</span>
<span id="cb299-85"><a href="database-interaction.html#cb299-85"></a>    }</span>
<span id="cb299-86"><a href="database-interaction.html#cb299-86"></a></span>
<span id="cb299-87"><a href="database-interaction.html#cb299-87"></a>    <span class="at">@Override</span></span>
<span id="cb299-88"><a href="database-interaction.html#cb299-88"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">insertUser</span>(<span class="bu">String</span> userName, <span class="bu">String</span> userPass, <span class="bu">String</span> email, <span class="bu">Role</span> role) <span class="kw">throws</span> DatabaseException  {</span>
<span id="cb299-89"><a href="database-interaction.html#cb299-89"></a>        <span class="kw">try</span>{</span>
<span id="cb299-90"><a href="database-interaction.html#cb299-90"></a>            <span class="bu">PreparedStatement</span> ps = <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">get</span>(INSERT_USER);</span>
<span id="cb299-91"><a href="database-interaction.html#cb299-91"></a>            ps.<span class="fu">setString</span>(<span class="dv">1</span>, userName);</span>
<span id="cb299-92"><a href="database-interaction.html#cb299-92"></a>            ps.<span class="fu">setString</span>(<span class="dv">2</span>, userPass);</span>
<span id="cb299-93"><a href="database-interaction.html#cb299-93"></a>            ps.<span class="fu">setString</span>(<span class="dv">3</span>, email);</span>
<span id="cb299-94"><a href="database-interaction.html#cb299-94"></a>            ps.<span class="fu">setString</span>(<span class="dv">4</span>, role.<span class="fu">toString</span>());</span>
<span id="cb299-95"><a href="database-interaction.html#cb299-95"></a>            ps.<span class="fu">executeUpdate</span>();</span>
<span id="cb299-96"><a href="database-interaction.html#cb299-96"></a>            ps.<span class="fu">close</span>();</span>
<span id="cb299-97"><a href="database-interaction.html#cb299-97"></a>        } <span class="kw">catch</span> (<span class="bu">Exception</span> ex) {</span>
<span id="cb299-98"><a href="database-interaction.html#cb299-98"></a>            ex.<span class="fu">printStackTrace</span>();</span>
<span id="cb299-99"><a href="database-interaction.html#cb299-99"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(<span class="st">&quot;Something is wrong with the database, see cause Exception&quot;</span>,</span>
<span id="cb299-100"><a href="database-interaction.html#cb299-100"></a>                    ex.<span class="fu">getCause</span>());</span>
<span id="cb299-101"><a href="database-interaction.html#cb299-101"></a>        }</span>
<span id="cb299-102"><a href="database-interaction.html#cb299-102"></a>    }</span>
<span id="cb299-103"><a href="database-interaction.html#cb299-103"></a></span>
<span id="cb299-104"><a href="database-interaction.html#cb299-104"></a>    <span class="at">@Override</span></span>
<span id="cb299-105"><a href="database-interaction.html#cb299-105"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">disconnect</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb299-106"><a href="database-interaction.html#cb299-106"></a>        <span class="co">/*After you are done, you must carefully clean up your database resources!*/</span></span>
<span id="cb299-107"><a href="database-interaction.html#cb299-107"></a>        <span class="co">/*These objects need to be closed explicitly:</span></span>
<span id="cb299-108"><a href="database-interaction.html#cb299-108"></a><span class="co">         *  `ResultSet` (here: done in method itself)</span></span>
<span id="cb299-109"><a href="database-interaction.html#cb299-109"></a><span class="co">         *  `PreparedStatemenent`</span></span>
<span id="cb299-110"><a href="database-interaction.html#cb299-110"></a><span class="co">         *  `Connection` (always last)</span></span>
<span id="cb299-111"><a href="database-interaction.html#cb299-111"></a><span class="co">         */</span></span>
<span id="cb299-112"><a href="database-interaction.html#cb299-112"></a>        <span class="kw">try</span>{</span>
<span id="cb299-113"><a href="database-interaction.html#cb299-113"></a>            <span class="kw">for</span>( <span class="bu">String</span> key : <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">keySet</span>() ){</span>
<span id="cb299-114"><a href="database-interaction.html#cb299-114"></a>                <span class="kw">this</span>.<span class="fu">preparedStatements</span>.<span class="fu">get</span>(key).<span class="fu">close</span>();</span>
<span id="cb299-115"><a href="database-interaction.html#cb299-115"></a>            }</span>
<span id="cb299-116"><a href="database-interaction.html#cb299-116"></a>        }<span class="kw">catch</span>( <span class="bu">Exception</span> e ){</span>
<span id="cb299-117"><a href="database-interaction.html#cb299-117"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb299-118"><a href="database-interaction.html#cb299-118"></a>        }</span>
<span id="cb299-119"><a href="database-interaction.html#cb299-119"></a>        <span class="kw">finally</span>{</span>
<span id="cb299-120"><a href="database-interaction.html#cb299-120"></a>            <span class="kw">try</span> {</span>
<span id="cb299-121"><a href="database-interaction.html#cb299-121"></a>                connection.<span class="fu">close</span>();</span>
<span id="cb299-122"><a href="database-interaction.html#cb299-122"></a>            } <span class="kw">catch</span> (<span class="bu">SQLException</span> e) {</span>
<span id="cb299-123"><a href="database-interaction.html#cb299-123"></a>                e.<span class="fu">printStackTrace</span>();</span>
<span id="cb299-124"><a href="database-interaction.html#cb299-124"></a>            }</span>
<span id="cb299-125"><a href="database-interaction.html#cb299-125"></a>        }</span>
<span id="cb299-126"><a href="database-interaction.html#cb299-126"></a>    }</span>
<span id="cb299-127"><a href="database-interaction.html#cb299-127"></a>}</span></code></pre></div>
</div>
<div id="create-a-factory-class" class="section level4 unnumbered">
<h4>3: Create a <strong><em>factory class</em></strong></h4>
<p>Here, class <code>MyAppDaoFactory</code> was created that will instantiate and serve the right type of implementer.
This should preferably be done based on some external configuration setting (such as <code>web.xml</code>).
Also note that the Database credentials are read from the external <code>.my.cnf</code> file here, using the
helper app discussed earlier.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb300-1"><a href="database-interaction.html#cb300-1"></a><span class="kw">package</span><span class="im"> nl.bioinf.wis_on_thymeleaf.dao;</span></span>
<span id="cb300-2"><a href="database-interaction.html#cb300-2"></a><span class="co">//imports deleted</span></span>
<span id="cb300-3"><a href="database-interaction.html#cb300-3"></a><span class="kw">public</span> <span class="kw">class</span> MyAppDaoFactory {</span>
<span id="cb300-4"><a href="database-interaction.html#cb300-4"></a>    <span class="kw">private</span> <span class="dt">static</span> MyAppDao daoInstance;</span>
<span id="cb300-5"><a href="database-interaction.html#cb300-5"></a></span>
<span id="cb300-6"><a href="database-interaction.html#cb300-6"></a>    <span class="co">/**</span></span>
<span id="cb300-7"><a href="database-interaction.html#cb300-7"></a>    <span class="co">*</span> Code should be called at application startup</span>
<span id="cb300-8"><a href="database-interaction.html#cb300-8"></a>    <span class="co">*/</span></span>
<span id="cb300-9"><a href="database-interaction.html#cb300-9"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">initializeDataSource</span>(<span class="bu">String</span> type) <span class="kw">throws</span> DatabaseException {</span>
<span id="cb300-10"><a href="database-interaction.html#cb300-10"></a>        <span class="kw">if</span> (daoInstance != <span class="kw">null</span>) {</span>
<span id="cb300-11"><a href="database-interaction.html#cb300-11"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;DAO can be initialized only once&quot;</span>);</span>
<span id="cb300-12"><a href="database-interaction.html#cb300-12"></a>        }</span>
<span id="cb300-13"><a href="database-interaction.html#cb300-13"></a>        <span class="kw">switch</span>(type) {</span>
<span id="cb300-14"><a href="database-interaction.html#cb300-14"></a>            <span class="kw">case</span> <span class="st">&quot;dummy&quot;</span>: {</span>
<span id="cb300-15"><a href="database-interaction.html#cb300-15"></a>                <span class="fu">createDummyInstance</span>();</span>
<span id="cb300-16"><a href="database-interaction.html#cb300-16"></a>                <span class="kw">break</span>;</span>
<span id="cb300-17"><a href="database-interaction.html#cb300-17"></a>            }</span>
<span id="cb300-18"><a href="database-interaction.html#cb300-18"></a>            <span class="kw">case</span> <span class="st">&quot;mysql&quot;</span>: {</span>
<span id="cb300-19"><a href="database-interaction.html#cb300-19"></a>                <span class="fu">createMySQLInstance</span>();</span>
<span id="cb300-20"><a href="database-interaction.html#cb300-20"></a>                <span class="kw">break</span>;</span>
<span id="cb300-21"><a href="database-interaction.html#cb300-21"></a>            }</span>
<span id="cb300-22"><a href="database-interaction.html#cb300-22"></a>            <span class="kw">default</span>: <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalArgumentException</span>(<span class="st">&quot;unknown database type requested&quot;</span>);</span>
<span id="cb300-23"><a href="database-interaction.html#cb300-23"></a>        }</span>
<span id="cb300-24"><a href="database-interaction.html#cb300-24"></a>    }</span>
<span id="cb300-25"><a href="database-interaction.html#cb300-25"></a></span>
<span id="cb300-26"><a href="database-interaction.html#cb300-26"></a>    <span class="co">/**</span></span>
<span id="cb300-27"><a href="database-interaction.html#cb300-27"></a>    <span class="co">*</span> serves the dao instance</span>
<span id="cb300-28"><a href="database-interaction.html#cb300-28"></a>    <span class="co">* @</span>return</span>
<span id="cb300-29"><a href="database-interaction.html#cb300-29"></a>    <span class="co">*/</span></span>
<span id="cb300-30"><a href="database-interaction.html#cb300-30"></a>    <span class="kw">public</span> <span class="dt">static</span> MyAppDao <span class="fu">getDataSource</span>() {</span>
<span id="cb300-31"><a href="database-interaction.html#cb300-31"></a>        <span class="kw">if</span> (daoInstance == <span class="kw">null</span>) {</span>
<span id="cb300-32"><a href="database-interaction.html#cb300-32"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="bu">IllegalStateException</span>(<span class="st">&quot;DAO is not initialized; call initializeDataSource() first&quot;</span>);</span>
<span id="cb300-33"><a href="database-interaction.html#cb300-33"></a>        }</span>
<span id="cb300-34"><a href="database-interaction.html#cb300-34"></a>        <span class="kw">return</span> daoInstance;</span>
<span id="cb300-35"><a href="database-interaction.html#cb300-35"></a>    }</span>
<span id="cb300-36"><a href="database-interaction.html#cb300-36"></a></span>
<span id="cb300-37"><a href="database-interaction.html#cb300-37"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">createDummyInstance</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb300-38"><a href="database-interaction.html#cb300-38"></a>        daoInstance = <span class="kw">new</span> <span class="fu">MyAppDaoInMemory</span>();</span>
<span id="cb300-39"><a href="database-interaction.html#cb300-39"></a>        daoInstance.<span class="fu">connect</span>();</span>
<span id="cb300-40"><a href="database-interaction.html#cb300-40"></a>    }</span>
<span id="cb300-41"><a href="database-interaction.html#cb300-41"></a></span>
<span id="cb300-42"><a href="database-interaction.html#cb300-42"></a>    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">createMySQLInstance</span>() <span class="kw">throws</span> DatabaseException {</span>
<span id="cb300-43"><a href="database-interaction.html#cb300-43"></a>        <span class="kw">try</span> {</span>
<span id="cb300-44"><a href="database-interaction.html#cb300-44"></a>            DbUser mySQLuser = DbCredentials.<span class="fu">getMySQLuser</span>();</span>
<span id="cb300-45"><a href="database-interaction.html#cb300-45"></a>            <span class="bu">String</span> dbUrl = <span class="st">&quot;jdbc:mysql://&quot;</span> + mySQLuser.<span class="fu">getHost</span>() + <span class="st">&quot;/&quot;</span> + mySQLuser.<span class="fu">getDatabaseName</span>();</span>
<span id="cb300-46"><a href="database-interaction.html#cb300-46"></a>            <span class="bu">String</span> dbUser = mySQLuser.<span class="fu">getUserName</span>();</span>
<span id="cb300-47"><a href="database-interaction.html#cb300-47"></a>            <span class="bu">String</span> dbPass = mySQLuser.<span class="fu">getDatabasePassword</span>();</span>
<span id="cb300-48"><a href="database-interaction.html#cb300-48"></a>            daoInstance = MyAppDaoMySQL.<span class="fu">getInstance</span>(dbUrl, dbUser, dbPass);</span>
<span id="cb300-49"><a href="database-interaction.html#cb300-49"></a>            daoInstance.<span class="fu">connect</span>();</span>
<span id="cb300-50"><a href="database-interaction.html#cb300-50"></a>        } <span class="kw">catch</span> (<span class="bu">IOException</span> | <span class="bu">NoSuchFieldException</span> e) {</span>
<span id="cb300-51"><a href="database-interaction.html#cb300-51"></a>            <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">DatabaseException</span>(e);</span>
<span id="cb300-52"><a href="database-interaction.html#cb300-52"></a>        }</span>
<span id="cb300-53"><a href="database-interaction.html#cb300-53"></a>    }</span>
<span id="cb300-54"><a href="database-interaction.html#cb300-54"></a>}</span></code></pre></div>
</div>
<div id="have-the-correct-type-instantiated" class="section level4 unnumbered">
<h4>4: Have the correct type instantiated</h4>
<p>Have the correct type instantiated at application startup.</p>
<p>The <code>web.xml</code> deployment descriptor is an excellent place to specify which implementation of the <code>MyAppDao</code> interface to use:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb301-1"><a href="database-interaction.html#cb301-1"></a>    <span class="kw">&lt;context-param&gt;</span></span>
<span id="cb301-2"><a href="database-interaction.html#cb301-2"></a>        <span class="kw">&lt;param-name&gt;</span>db-type<span class="kw">&lt;/param-name&gt;</span></span>
<span id="cb301-3"><a href="database-interaction.html#cb301-3"></a>        <span class="kw">&lt;param-value&gt;</span>mysql<span class="kw">&lt;/param-value&gt;</span></span>
<span id="cb301-4"><a href="database-interaction.html#cb301-4"></a>    <span class="kw">&lt;/context-param&gt;</span></span></code></pre></div>
<p>The datasource needs to be initialized at application startup, requested from the class <code>MyAppDaoFactory</code>.
You have seen the application startup hook in a previous post (see <a href="servlet_details.md">servlet details and lifecycle hooks</a>);
it was implemented in class <code>WebConfig</code>.
Here, the DAO initialization is done within that method, <code>contextInitialized()</code>.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb302-1"><a href="database-interaction.html#cb302-1"></a><span class="at">@WebListener</span></span>
<span id="cb302-2"><a href="database-interaction.html#cb302-2"></a><span class="kw">public</span> <span class="kw">class</span> WebConfig <span class="kw">implements</span> ServletContextListener {</span>
<span id="cb302-3"><a href="database-interaction.html#cb302-3"></a></span>
<span id="cb302-4"><a href="database-interaction.html#cb302-4"></a>    <span class="at">@Override</span></span>
<span id="cb302-5"><a href="database-interaction.html#cb302-5"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">contextInitialized</span>(ServletContextEvent servletContextEvent) {</span>
<span id="cb302-6"><a href="database-interaction.html#cb302-6"></a>        <span class="co">//other code</span></span>
<span id="cb302-7"><a href="database-interaction.html#cb302-7"></a></span>
<span id="cb302-8"><a href="database-interaction.html#cb302-8"></a>        <span class="co">//fetch the database type</span></span>
<span id="cb302-9"><a href="database-interaction.html#cb302-9"></a>        <span class="bu">String</span> dbType = servletContextEvent.<span class="fu">getServletContext</span>().<span class="fu">getInitParameter</span>(<span class="st">&quot;db-type&quot;</span>);</span>
<span id="cb302-10"><a href="database-interaction.html#cb302-10"></a>        <span class="kw">try</span> {</span>
<span id="cb302-11"><a href="database-interaction.html#cb302-11"></a>            MyAppDaoFactory.<span class="fu">initializeDataSource</span>(dbType);</span>
<span id="cb302-12"><a href="database-interaction.html#cb302-12"></a>        } <span class="kw">catch</span> (DatabaseException e) {</span>
<span id="cb302-13"><a href="database-interaction.html#cb302-13"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb302-14"><a href="database-interaction.html#cb302-14"></a>            <span class="co">//this should be logged of course; and dealt with elegantly</span></span>
<span id="cb302-15"><a href="database-interaction.html#cb302-15"></a>        }</span>
<span id="cb302-16"><a href="database-interaction.html#cb302-16"></a>    }</span>
<span id="cb302-17"><a href="database-interaction.html#cb302-17"></a>    <span class="co">//other code</span></span>
<span id="cb302-18"><a href="database-interaction.html#cb302-18"></a>}</span></code></pre></div>
</div>
<div id="use-the-interface-type-in-your-code-base" class="section level4 unnumbered">
<h4>5: Use the interface type in your code base</h4>
<p>It is now easy to get hold of the connector anywhere in our application because we can call the static method <code>getInstance()</code>.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb303-1"><a href="database-interaction.html#cb303-1"></a>MyAppDao dao = MyDbConnector.<span class="fu">getInstance</span>();</span></code></pre></div>
</div>
<div id="singleton" class="section level3">
<h3><span class="header-section-number">36.4.1</span> Singleton</h3>
<p>I want class <code>DbCredentials</code> to be instantiated only once - we do not want to create resource-heavy classes twice if we can prevent it. To guarantee this, the <strong><em>singleton pattern</em></strong> is implemented. It has three components:</p>
<ul>
<li>a private static instance</li>
<li>a private constructor (only this class can instantiate itself)</li>
<li>a public static method serving the single instance</li>
</ul>
<div class="sourceCode" id="cb304"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb304-1"><a href="database-interaction.html#cb304-1"></a>    <span class="kw">private</span> <span class="dt">static</span> MyAppDaoMySQL uniqueInstance;</span>
<span id="cb304-2"><a href="database-interaction.html#cb304-2"></a></span>
<span id="cb304-3"><a href="database-interaction.html#cb304-3"></a>    <span class="kw">private</span> <span class="fu">MyAppDaoMySQL</span>(<span class="bu">String</span> url, <span class="bu">String</span> dbUser, <span class="bu">String</span> dbPassword) {</span>
<span id="cb304-4"><a href="database-interaction.html#cb304-4"></a>        <span class="kw">this</span>.<span class="fu">url</span> = url;</span>
<span id="cb304-5"><a href="database-interaction.html#cb304-5"></a>        <span class="kw">this</span>.<span class="fu">dbUser</span> = dbUser;</span>
<span id="cb304-6"><a href="database-interaction.html#cb304-6"></a>        <span class="kw">this</span>.<span class="fu">dbPassword</span> = dbPassword;</span>
<span id="cb304-7"><a href="database-interaction.html#cb304-7"></a>    }</span>
<span id="cb304-8"><a href="database-interaction.html#cb304-8"></a></span>
<span id="cb304-9"><a href="database-interaction.html#cb304-9"></a>    <span class="kw">public</span> <span class="dt">static</span> MyAppDaoMySQL <span class="fu">getInstance</span>(<span class="bu">String</span> url, <span class="bu">String</span> dbUser, <span class="bu">String</span> dbPassword) {</span>
<span id="cb304-10"><a href="database-interaction.html#cb304-10"></a>        <span class="co">//lazy instantiation</span></span>
<span id="cb304-11"><a href="database-interaction.html#cb304-11"></a>        <span class="kw">if</span> (uniqueInstance == <span class="kw">null</span>) {</span>
<span id="cb304-12"><a href="database-interaction.html#cb304-12"></a>            uniqueInstance = <span class="kw">new</span> <span class="fu">MyAppDaoMySQL</span>(url, dbUser, dbPassword);</span>
<span id="cb304-13"><a href="database-interaction.html#cb304-13"></a>        }</span>
<span id="cb304-14"><a href="database-interaction.html#cb304-14"></a>        <span class="kw">return</span> uniqueInstance;</span>
<span id="cb304-15"><a href="database-interaction.html#cb304-15"></a>    }</span></code></pre></div>
<p>Key here is the private constructor which guarantees ony code within class <code>MyAppDaoMySQL</code> can instantiate its objects, and it does so only once.
This solution is simple, but <strong>not thread safe!</strong>. In a later course, we’ll revisit this.</p>
</div>
</div>
<div id="use-in-a-servlet-environment" class="section level2">
<h2><span class="header-section-number">36.5</span> Use in a servlet environment</h2>
<p>Here is the relevant servlet code:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb305-1"><a href="database-interaction.html#cb305-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">doGet</span>(HttpServletRequest request, HttpServletResponse response) <span class="kw">throws</span> ServletException, <span class="bu">IOException</span> {</span>
<span id="cb305-2"><a href="database-interaction.html#cb305-2"></a>        <span class="dt">final</span> MyAppDao dataSource = MyAppDaoFactory.<span class="fu">getDataSource</span>();</span>
<span id="cb305-3"><a href="database-interaction.html#cb305-3"></a>        <span class="kw">try</span> {</span>
<span id="cb305-4"><a href="database-interaction.html#cb305-4"></a>            <span class="dt">final</span> User user = dataSource.<span class="fu">getUser</span>(<span class="st">&quot;Henk&quot;</span>, <span class="st">&quot;Henkie&quot;</span>);</span>
<span id="cb305-5"><a href="database-interaction.html#cb305-5"></a>            <span class="dt">final</span> TemplateEngine templateEngine = WebConfig.<span class="fu">getTemplateEngine</span>();</span>
<span id="cb305-6"><a href="database-interaction.html#cb305-6"></a>            WebContext ctx = <span class="kw">new</span> <span class="fu">WebContext</span>(request, response, request.<span class="fu">getServletContext</span>(), request.<span class="fu">getLocale</span>());</span>
<span id="cb305-7"><a href="database-interaction.html#cb305-7"></a>            ctx.<span class="fu">setVariable</span>(<span class="st">&quot;user&quot;</span>, user);</span>
<span id="cb305-8"><a href="database-interaction.html#cb305-8"></a>            templateEngine.<span class="fu">process</span>(<span class="st">&quot;user-details&quot;</span>, ctx, response.<span class="fu">getWriter</span>());</span>
<span id="cb305-9"><a href="database-interaction.html#cb305-9"></a>        } <span class="kw">catch</span> (DatabaseException e) {</span>
<span id="cb305-10"><a href="database-interaction.html#cb305-10"></a>            e.<span class="fu">printStackTrace</span>();</span>
<span id="cb305-11"><a href="database-interaction.html#cb305-11"></a>        }</span></code></pre></div>
<p>and the thymeleaf view:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb306-1"><a href="database-interaction.html#cb306-1"></a><span class="dt">&lt;!DOCTYPE </span>html SYSTEM &quot;http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd&quot;<span class="dt">&gt;</span></span>
<span id="cb306-2"><a href="database-interaction.html#cb306-2"></a><span class="kw">&lt;html</span><span class="ot"> xmlns=</span><span class="st">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="ot"> xmlns:th=</span><span class="st">&quot;http://www.thymeleaf.org&quot;</span><span class="kw">&gt;</span></span>
<span id="cb306-3"><a href="database-interaction.html#cb306-3"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb306-4"><a href="database-interaction.html#cb306-4"></a>    <span class="kw">&lt;title&gt;</span>Show user<span class="kw">&lt;/title&gt;</span></span>
<span id="cb306-5"><a href="database-interaction.html#cb306-5"></a>    <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">&quot;Content-Type&quot;</span><span class="ot"> content=</span><span class="st">&quot;text/html; charset=UTF-8&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb306-6"><a href="database-interaction.html#cb306-6"></a>    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;js/myPage.js&quot;</span><span class="ot"> type=</span><span class="st">&quot;application/javascript&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb306-7"><a href="database-interaction.html#cb306-7"></a><span class="kw">&lt;/head&gt;</span></span>
<span id="cb306-8"><a href="database-interaction.html#cb306-8"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb306-9"><a href="database-interaction.html#cb306-9"></a><span class="co">&lt;!-- welcome message read from resource bundle welcome.html--&gt;</span></span>
<span id="cb306-10"><a href="database-interaction.html#cb306-10"></a><span class="kw">&lt;h2</span><span class="ot"> th:text=</span><span class="st">&quot;&#39;Welcome &#39; + ${user.name}&quot;</span><span class="kw">&gt;&lt;/h2&gt;</span></span>
<span id="cb306-11"><a href="database-interaction.html#cb306-11"></a><span class="kw">&lt;h3</span><span class="ot"> th:text=</span><span class="st">&quot;&#39;Your account email: &#39; + ${user.email}&quot;</span><span class="kw">&gt;&lt;/h3&gt;</span></span>
<span id="cb306-12"><a href="database-interaction.html#cb306-12"></a><span class="kw">&lt;h3</span><span class="ot"> th:text=</span><span class="st">&quot;&#39;Your Role: &#39; + ${user.role.name}&quot;</span><span class="kw">&gt;&lt;/h3&gt;</span></span>
<span id="cb306-13"><a href="database-interaction.html#cb306-13"></a><span class="kw">&lt;/body&gt;</span></span>
<span id="cb306-14"><a href="database-interaction.html#cb306-14"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>Below you see the results with the two different values for the same <code>web.xml</code> context-param entry. The code does not know which implementation is running.</p>
<p><strong>db-type=mysql</strong><br />
Here, the MySQL database is queried:</p>
<div class="figure">
<img src="05_web/figures/datasource_mysql.png" alt="" />
<p class="caption">Datasourse MySQL</p>
</div>
<p><strong>db-type=dummy</strong><br />
And this queries the internal dummy database:</p>
<div class="figure">
<img src="05_web/figures/datasource_dummy.png" alt="" />
<p class="caption">Datasource Dummy</p>
</div>
<p>This constitutes the final layer in the app: the data layer:</p>
<div class="figure">
<img src="05_web/figures/mvc_with_data_layer.png" alt="" />
<p class="caption">MVC</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="servlet-details-and-lifecycle-hooks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-simple-web-service-using-ajax.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["The Java Track.pdf", "The Java Track.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
