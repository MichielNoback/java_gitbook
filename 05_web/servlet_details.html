
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Servlet details & Lifecycle hooks Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="databases.html" />
    
    
    <link rel="prev" href="sessions.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../shortcuts.html">
            
                <a href="../shortcuts.html">
            
                    
                    IntelliJ keyboard shortcuts
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: Getting started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../01_getting_started/intellij.html">
            
                <a href="../01_getting_started/intellij.html">
            
                    
                    A first IntelliJ project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../01_getting_started/essentials.html">
            
                <a href="../01_getting_started/essentials.html">
            
                    
                    The essentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../01_getting_started/first_look_at_objects.html">
            
                <a href="../01_getting_started/first_look_at_objects.html">
            
                    
                    Demo case: A first look at objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../02_syntax/basic_program_design.html">
            
                <a href="../02_syntax/basic_program_design.html">
            
                    
                    Basic program design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../02_syntax/naming_commenting.html">
            
                <a href="../02_syntax/naming_commenting.html">
            
                    
                    Naming and commenting
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 2: Syntax</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../02_syntax/data_types.html">
            
                <a href="../02_syntax/data_types.html">
            
                    
                    Data types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../02_syntax/arrays.html">
            
                <a href="../02_syntax/arrays.html">
            
                    
                    Arrays
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../02_syntax/operators.html">
            
                <a href="../02_syntax/operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../02_syntax/flow_control.html">
            
                <a href="../02_syntax/flow_control.html">
            
                    
                    Flow control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../02_syntax/methods.html">
            
                <a href="../02_syntax/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../02_syntax/packages_imports.html">
            
                <a href="../02_syntax/packages_imports.html">
            
                    
                    Packages & Imports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../02_syntax/demo_case_naming.html">
            
                <a href="../02_syntax/demo_case_naming.html">
            
                    
                    Demo case: The power of good names
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 3: Core APIs</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../03_apis/interfaces.html">
            
                <a href="../03_apis/interfaces.html">
            
                    
                    Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../03_apis/collections.html">
            
                <a href="../03_apis/collections.html">
            
                    
                    Collections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../03_apis/class_object_methods.html">
            
                <a href="../03_apis/class_object_methods.html">
            
                    
                    Methods of class Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../03_apis/sorting.html">
            
                <a href="../03_apis/sorting.html">
            
                    
                    Sorting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../03_apis/exceptions.html">
            
                <a href="../03_apis/exceptions.html">
            
                    
                    Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../03_apis/io.html">
            
                <a href="../03_apis/io.html">
            
                    
                    File IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../03_apis/regex.html">
            
                <a href="../03_apis/regex.html">
            
                    
                    Regular Expressions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 4: Object-oriented programming</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../04_oop/class_design.html">
            
                <a href="../04_oop/class_design.html">
            
                    
                    Encapsulation through access modifiers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../04_oop/access_modifiers.html">
            
                <a href="../04_oop/access_modifiers.html">
            
                    
                    Access modifiers & other keywords
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../04_oop/inheritance.html">
            
                <a href="../04_oop/inheritance.html">
            
                    
                    Inheritance and UML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../04_oop/enums.html">
            
                <a href="../04_oop/enums.html">
            
                    
                    Enums
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../04_oop/encapsulation.html">
            
                <a href="../04_oop/encapsulation.html">
            
                    
                    Encapsulation revisited
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../04_oop/inner_classes.html">
            
                <a href="../04_oop/inner_classes.html">
            
                    
                    Inner classes
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Summaries Part 1-4</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../design_rules.html">
            
                <a href="../design_rules.html">
            
                    
                    Design Rules summary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 5: Web-based Java & Thymeleaf</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="refresher.html">
            
                <a href="refresher.html">
            
                    
                    Refresher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="toolbox.html">
            
                <a href="toolbox.html">
            
                    
                    Toolbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="first_project.html">
            
                <a href="first_project.html">
            
                    
                    A first project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="mvc.html">
            
                <a href="mvc.html">
            
                    
                    Implementing MVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="thymeleaf_expressions.html">
            
                <a href="thymeleaf_expressions.html">
            
                    
                    Thymeleaf expression types & objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="thymeleaf_flow_control.html">
            
                <a href="thymeleaf_flow_control.html">
            
                    
                    Thymeleaf flow control & fragments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="sessions.html">
            
                <a href="sessions.html">
            
                    
                    Sessions & Scopes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="7.8" data-path="servlet_details.html">
            
                <a href="servlet_details.html">
            
                    
                    Servlet details & Lifecycle hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.9" data-path="databases.html">
            
                <a href="databases.html">
            
                    
                    Database interaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.10" data-path="ajax.html">
            
                <a href="ajax.html">
            
                    
                    Ajax communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.11" data-path="filters_upload.html">
            
                <a href="filters_upload.html">
            
                    
                    Web filters and file uploads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.12" data-path="webbased_exercises1.html">
            
                <a href="webbased_exercises1.html">
            
                    
                    Exercises Web-based Information Systems 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.13" data-path="html_cheatsheet.html">
            
                <a href="html_cheatsheet.html">
            
                    
                    html cheat sheet
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 6: Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../06_tools/JUnit_basics.html">
            
                <a href="../06_tools/JUnit_basics.html">
            
                    
                    JUnit 5 Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../06_tools/JUnit_advanced.html">
            
                <a href="../06_tools/JUnit_advanced.html">
            
                    
                    JUnit 5 Advanced
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Servlet details & Lifecycle hooks</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="servlet-details-and-lifecycle-hooks">Servlet details and lifecycle hooks</h1>
<h2 id="introduction">Introduction</h2>
<p>In this post, some details of servlet configuration are discussed, as well as techniques that you can use to hook into life cycle events, the main ones being application startup and -shutdown, and first request on a servlet.</p>
<h2 id="servlet-configuration">Servlet configuration</h2>
<p>The @WebServlet annotation offers several possibilities for configuration. Here are the interesting ones:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>urlPatterns or value</td>
<td>String[]</td>
<td>y</td>
<td>Specify one or more URL patterns of the servlet. Either of attribute can be used, but not both</td>
</tr>
<tr>
<td>asyncSupported</td>
<td>String</td>
<td>n</td>
<td>Specify whether the servlet supports asynchronous operation mode. Default is false.</td>
</tr>
<tr>
<td>initParams</td>
<td>WebInitParam[]</td>
<td>n</td>
<td>Specify one or more initialization parameters of the servlet. Each parameter is specified by @WebInitParam annotation type.</td>
</tr>
<tr>
<td>loadOnStartup</td>
<td>int</td>
<td>n</td>
<td>Specify load-on-startup order of the servlet. Default is -1</td>
</tr>
</tbody>
</table>
<h4 id="webservlet---urlpatterns">@Webservlet - urlPatterns</h4>
<p>The <code>urlPatterns</code> parameter specifies which urls will map on your servlet.
This configuration:</p>
<pre><code class="lang-java"><span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">&quot;WelcomeServlet&quot;</span>, 
            urlPatterns = {<span class="hljs-string">&quot;/welcome&quot;</span>, <span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-string">&quot;/home&quot;</span>})
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WelcomeServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{ ... }
</code></pre>
<p>maps all these requests to <code>WelcomeServlet</code>:</p>
<ul>
<li><a href="http://localhost:8080/index" target="_blank">http://localhost:8080/index</a></li>
<li><a href="http://localhost:8080/welcome" target="_blank">http://localhost:8080/welcome</a></li>
<li><a href="http://localhost:8080/home" target="_blank">http://localhost:8080/home</a></li>
</ul>
<h4 id="webservlet---loadonstartup">@Webservlet - loadOnStartup</h4>
<p>The <code>loadOnStartup</code> parameter is an integer which specifies the servlet load order. 
The container loads servlets with lower values before servlets with higher values.
If <code>loadOnStartup</code> is negative (it defaults to -1), the servlet will be loaded when the container decides to - typically on first access.</p>
<pre><code class="lang-java"><span class="hljs-meta">@WebServlet</span>(urlPatterns = {<span class="hljs-string">&quot;/welcome&quot;</span>},
     loadOnStartup = <span class="hljs-number">1</span>) 
     <span class="hljs-comment">//guarantees first loading at deployment</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WelcomeServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{ ... }
</code></pre>
<h4 id="webservlet-&#x2013;-initparams">@Webservlet &#x2013; initParams</h4>
<p>Servlet initialization parameters are defined as instances of <code>@WebInitParam</code>.</p>
<pre><code class="lang-java"><span class="hljs-meta">@WebServlet</span>(urlPatterns = {<span class="hljs-string">&quot;/welcome&quot;</span>},
    initParams = {
        <span class="hljs-meta">@WebInitParam</span>(name = <span class="hljs-string">&quot;tempDir&quot;</span>, value = <span class="hljs-string">&quot;/tmp&quot;</span>),
        <span class="hljs-meta">@WebInitParam</span>(name = <span class="hljs-string">&quot;allowedFileTypes&quot;</span>, value = <span class="hljs-string">&quot;jpg,png&quot;</span>)
    })
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WelcomeServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{ 
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-keyword">final</span> String tempDir = getInitParameter(<span class="hljs-string">&quot;tempDir&quot;</span>);
        System.out.println(<span class="hljs-string">&quot;tempDir = &quot;</span> + tempDir);
        System.out.println(<span class="hljs-string">&quot;admin_email = &quot;</span> + getServletContext().getInitParameter(<span class="hljs-string">&quot;admin_email&quot;</span>));
    }
    <span class="hljs-comment">//more code</span>
}
</code></pre>
<p>will output to the console</p>
<pre class="console_out">
tempDir = /tmp
admin_email = admin@example.com
</pre>

<p>You can specify the same information in web.xml, which seems a bit more logical:</p>
<pre><code class="lang-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/welcome<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>nl.bioinf.wis_on_thymeleaf.servlets.WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>tempDir<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/some/location<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
</code></pre>
<h4 id="webservlet-versus-webxml-configuration">@Webservlet versus web.xml configuration</h4>
<p>When configuration is done in both <code>web.xml</code> &#xE1;nd in <code>@WebServlet</code> annotations, the <code>web.xml</code> configuration takes precedence.</p>
<p>A use case for this behaviour would be: development mode versus production mode.</p>
<p>With these two &quot;conflicting&quot; configurations, the url will become <code>/extra</code> and tempDir <code>/some/location</code>. The url <code>/welcome</code> will return a 404 not found!</p>
<pre><code class="lang-java"><span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">&quot;WelcomeServlet&quot;</span>,
  urlPatterns = {<span class="hljs-string">&quot;/welcome&quot;</span>, <span class="hljs-string">&quot;/home&quot;</span>},
    initParams = {<span class="hljs-meta">@WebInitParam</span>(name = <span class="hljs-string">&quot;tempDir&quot;</span>, value = <span class="hljs-string">&quot;/tmp&quot;</span>)}
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WelcomeServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{ }
</code></pre>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/extra<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>nl.bioinf.wis_on_thymeleaf.servlets.WelcomeServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>tempDir<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/some/location<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
</code></pre>
<h4 id="webservlet-&#x2013;-asyncsupported">@Webservlet &#x2013; asyncSupported</h4>
<p>This allows the servlet to store incoming requests for later response. 
For practical purposes, with this configuration you can set up a servlet that will (in effect) push data to the client (after the client sends the initial request to the server).
This is very interesting, but outside the scope of this course.</p>
<h2 id="hooks">Hooks</h2>
<p>Hooks are pieces of code that let you write code that will run at application life cycle events.
The ones we will look at here are:</p>
<ul>
<li>Application startup/shutdown hook</li>
<li>Servlet initialization/cleanup hooks</li>
</ul>
<h3 id="application-startup--shutdown">Application startup &amp; shutdown</h3>
<p>If you want to do something at </p>
<ul>
<li>startup &#x2013; e.g. create a single template engine to service all servlets</li>
<li>shutdown &#x2013; e.g. free DB resources
you annotate a class with <code>@WebListener</code> and have it 
implement the <code>ServletContextListener</code> interface.</li>
</ul>
<p>Here is an implementation. It uses the startup hook to create a single <code>TemplateEngine</code> instance that can be served to all servlets, guaranteeing that this code will have run first and only once.</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.config;

<span class="hljs-comment">//imports removed</span>

<span class="hljs-meta">@WebListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TemplateEngine templateEngine;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent servletContextEvent)</span> </span>{
        System.out.println(<span class="hljs-string">&quot;[WebConfig] Initializing template engine&quot;</span>);
        createTemplateEngine(servletContextEvent.getServletContext());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextDestroyed</span><span class="hljs-params">(ServletContextEvent servletContextEvent)</span> </span>{
        System.out.println(<span class="hljs-string">&quot;Shutting down!&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createTemplateEngine</span><span class="hljs-params">(ServletContext servletContext)</span> </span>{
        ServletContextTemplateResolver templateResolver =
                <span class="hljs-keyword">new</span> ServletContextTemplateResolver(servletContext);
        templateResolver.setTemplateMode(<span class="hljs-string">&quot;XHTML&quot;</span>);
        templateResolver.setPrefix(<span class="hljs-string">&quot;/WEB-INF/templates/&quot;</span>);
        templateResolver.setSuffix(<span class="hljs-string">&quot;.html&quot;</span>);
        templateResolver.setCacheTTLMs(<span class="hljs-number">3600000L</span>);
        <span class="hljs-comment">// Cache is set to true by default.</span>
        <span class="hljs-comment">// Set to false if you want templates to be automatically</span>
        <span class="hljs-comment">// updated when modified.</span>
        templateResolver.setCacheable(<span class="hljs-keyword">true</span>);

        TemplateEngine templateEngine = <span class="hljs-keyword">new</span> TemplateEngine();
        templateEngine.setTemplateResolver(templateResolver);
        WebConfig.templateEngine = templateEngine;
    }

    <span class="hljs-comment">/**
     * serves the template engine that was created at application startup.
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TemplateEngine <span class="hljs-title">getTemplateEngine</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> templateEngine;
    }

    <span class="hljs-comment">//method omitted</span>
}
</code></pre>
<h3 id="servlet-initialization-and-destroy">Servlet initialization and destroy</h3>
<p>When a first request is received for a servlet after application startup, the servlet container (Tomcat) will call 
the <code>init()</code> methods, if present. Method <code>init()</code> is guaranteed to be called before the first call to <code>service()</code>.</p>
<p><img src="figures/servlet_lifecycle_s.png" alt="servlet_lifecycle.png"></p>
<ul>
<li><code>init(ServletConfig config)</code> is called by the servlet container to indicate to a servlet that the servlet is being placed into service.</li>
<li><code>init()</code> is a convenience method which can be overridden so that there&apos;s no need to call super.init(config).</li>
<li><code>destroy()</code> is called by the servlet container to indicate to a servlet that the servlet is being taken out of service</li>
</ul>
<p>There are two overloaded variants defined in class <code>GenericServlet</code> that you can hook into to handle your startup actions:</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-keyword">this</span>.config = config;
        <span class="hljs-keyword">this</span>.init();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>{
    }
</code></pre>
<p>As you can see the first one calls the second one. Depending on your need for the <code>ServletConfig</code> object -which gives access to application-scoped variables-, you can choose either one of them to override. Here are all three (in class <code>PhraseServlet</code>, for demo purposes):</p>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-comment">//no super.init() required</span>
        System.out.println(<span class="hljs-string">&quot;[PhraseServlet] Running no-arg init()&quot;</span>);
        <span class="hljs-keyword">this</span>.templateEngine = WebConfig.getTemplateEngine();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-keyword">super</span>.init(config); <span class="hljs-comment">//required in this implementation</span>
        System.out.println(<span class="hljs-string">&quot;[PhraseServlet] Running init(ServletConfig config)&quot;</span>);
        config.getServletContext().getInitParameter(<span class="hljs-string">&quot;admin_email&quot;</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.destroy();
        System.out.println(<span class="hljs-string">&quot;[PhraseServlet] Shutting down servlet service&quot;</span>);
    }
</code></pre>
<p>In general, you use these init() methods to initialize &quot;expensive&quot; resources that you only want to create once. Good examples are importing config files, creating database connections (although there may be better solutions for that) or getting template engines, as in this example. Likewise, the <code>destroy</code> method can be used to elegantly shut down resources.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="sessions.html" class="navigation navigation-prev " aria-label="Previous page: Sessions & Scopes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="databases.html" class="navigation navigation-next " aria-label="Next page: Database interaction">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Servlet details & Lifecycle hooks","level":"7.8","depth":1,"next":{"title":"Database interaction","level":"7.9","depth":1,"path":"05_web/databases.md","ref":"05_web/databases.md","articles":[]},"previous":{"title":"Sessions & Scopes","level":"7.7","depth":1,"path":"05_web/sessions.md","ref":"05_web/sessions.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["page-toc"],"pluginsConfig":{"page-toc":{"position":"before-first","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3","showByDefault":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"05_web/servlet_details.md","mtime":"2019-11-14T15:33:04.956Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-12-03T10:18:24.894Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

