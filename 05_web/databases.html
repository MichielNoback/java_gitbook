
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Database interaction Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="ajax.html" />
    
    
    <link rel="prev" href="servlet_details.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../shortcuts.html">
            
                <a href="../shortcuts.html">
            
                    
                    IntelliJ keyboard shortcuts
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: Getting started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../01_getting_started/intellij.html">
            
                <a href="../01_getting_started/intellij.html">
            
                    
                    A first IntelliJ project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../01_getting_started/essentials.html">
            
                <a href="../01_getting_started/essentials.html">
            
                    
                    The essentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../01_getting_started/first_look_at_objects.html">
            
                <a href="../01_getting_started/first_look_at_objects.html">
            
                    
                    Demo case: A first look at objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../02_syntax/basic_program_design.html">
            
                <a href="../02_syntax/basic_program_design.html">
            
                    
                    Basic program design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../02_syntax/naming_commenting.html">
            
                <a href="../02_syntax/naming_commenting.html">
            
                    
                    Naming and commenting
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 2: Syntax</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../02_syntax/data_types.html">
            
                <a href="../02_syntax/data_types.html">
            
                    
                    Data types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../02_syntax/arrays.html">
            
                <a href="../02_syntax/arrays.html">
            
                    
                    Arrays
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../02_syntax/operators.html">
            
                <a href="../02_syntax/operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../02_syntax/flow_control.html">
            
                <a href="../02_syntax/flow_control.html">
            
                    
                    Flow control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../02_syntax/methods.html">
            
                <a href="../02_syntax/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../02_syntax/packages_imports.html">
            
                <a href="../02_syntax/packages_imports.html">
            
                    
                    Packages & Imports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../02_syntax/demo_case_naming.html">
            
                <a href="../02_syntax/demo_case_naming.html">
            
                    
                    Demo case: The power of good names
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 3: Core APIs</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../03_apis/interfaces.html">
            
                <a href="../03_apis/interfaces.html">
            
                    
                    Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../03_apis/collections.html">
            
                <a href="../03_apis/collections.html">
            
                    
                    Collections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../03_apis/class_object_methods.html">
            
                <a href="../03_apis/class_object_methods.html">
            
                    
                    Methods of class Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../03_apis/sorting.html">
            
                <a href="../03_apis/sorting.html">
            
                    
                    Sorting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../03_apis/exceptions.html">
            
                <a href="../03_apis/exceptions.html">
            
                    
                    Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../03_apis/io.html">
            
                <a href="../03_apis/io.html">
            
                    
                    File IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../03_apis/regex.html">
            
                <a href="../03_apis/regex.html">
            
                    
                    Regular Expressions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 4: Object-oriented programming</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../04_oop/class_design.html">
            
                <a href="../04_oop/class_design.html">
            
                    
                    Encapsulation through access modifiers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../04_oop/access_modifiers.html">
            
                <a href="../04_oop/access_modifiers.html">
            
                    
                    Access modifiers & other keywords
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../04_oop/inheritance.html">
            
                <a href="../04_oop/inheritance.html">
            
                    
                    Inheritance and UML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../04_oop/enums.html">
            
                <a href="../04_oop/enums.html">
            
                    
                    Enums
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../04_oop/encapsulation.html">
            
                <a href="../04_oop/encapsulation.html">
            
                    
                    Encapsulation revisited
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../04_oop/inner_classes.html">
            
                <a href="../04_oop/inner_classes.html">
            
                    
                    Inner classes
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Summaries Part 1-4</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../design_rules.html">
            
                <a href="../design_rules.html">
            
                    
                    Design Rules summary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 5: Web-based Java & Thymeleaf</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="refresher.html">
            
                <a href="refresher.html">
            
                    
                    Refresher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="toolbox.html">
            
                <a href="toolbox.html">
            
                    
                    Toolbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="first_project.html">
            
                <a href="first_project.html">
            
                    
                    A first project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="mvc.html">
            
                <a href="mvc.html">
            
                    
                    Implementing MVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="thymeleaf_expressions.html">
            
                <a href="thymeleaf_expressions.html">
            
                    
                    Thymeleaf expression types & objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="thymeleaf_flow_control.html">
            
                <a href="thymeleaf_flow_control.html">
            
                    
                    Thymeleaf flow control & fragments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="sessions.html">
            
                <a href="sessions.html">
            
                    
                    Sessions & Scopes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="servlet_details.html">
            
                <a href="servlet_details.html">
            
                    
                    Servlet details & Lifecycle hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="7.9" data-path="databases.html">
            
                <a href="databases.html">
            
                    
                    Database interaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.10" data-path="ajax.html">
            
                <a href="ajax.html">
            
                    
                    Ajax communication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.11" data-path="filters_upload.html">
            
                <a href="filters_upload.html">
            
                    
                    Web filters and file uploads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.12" data-path="webbased_exercises1.html">
            
                <a href="webbased_exercises1.html">
            
                    
                    Exercises Web-based Information Systems 1
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 6: Developer tools</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../06_tools/JUnit_basics.html">
            
                <a href="../06_tools/JUnit_basics.html">
            
                    
                    JUnit 5 Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../06_tools/JUnit_advanced.html">
            
                <a href="../06_tools/JUnit_advanced.html">
            
                    
                    JUnit 5 Advanced
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Database interaction</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="database-interaction-and-a-bit-of-software-design">Database interaction<br> (and a bit of software design)</h1>
<h2 id="introduction">Introduction</h2>
<p>In this post, these topics will be discussed:</p>
<ul>
<li>Database interaction with Java applications: JDBC</li>
<li>Java design issues that ensure flexible, reusable code that will easily deal with changing specs:<ul>
<li>a different database provider</li>
<li>a different view</li>
<li>different analysis components</li>
<li>etc etc</li>
</ul>
</li>
</ul>
<p>Just remember: <strong><em>the only constant in programming is change</em></strong>.</p>
<p>&#x21D2; Have a look at the <a href="https://bitbucket.org/minoba/java_web_thymeleaf_demo" target="_blank">repo</a> to see the full code of these examples.</p>
<h2 id="jdbc">JDBC</h2>
<p>Having Java applications talk with MySQL databases require that you have the required Driver in your project class path. Let&apos;s start with that. Put this line in te dependencies section of your <code>build.gradle</code> file:</p>
<pre><code class="lang-gradle"><span class="hljs-comment">// https://mvnrepository.com/artifact/mysql/mysql-connector-java  </span>
<span class="hljs-keyword">compile</span> <span class="hljs-keyword">group</span>: <span class="hljs-string">&apos;mysql&apos;</span>, name: <span class="hljs-string">&apos;mysql-connector-java&apos;</span>, version: <span class="hljs-string">&apos;5.1.6&apos;</span>
</code></pre>
<p>You may need to refresh your Gradle project in the Gradle Tool window, if you did not check the auto refresh option when creating the project. </p>
<p><img src="figures/refresh_gradle_project.png" alt="refresh"></p>
<h3 id="the-database">The database</h3>
<p>Of course, you will need a MySQL server, a database and an account. Deal with that first before proceeding, if you don&apos;t have that!</p>
<p>Suppose we have a database called MyDB with this single, simple table <code>Users</code>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user_id</code></td>
<td><code>int AUTO-INCREMENT</code></td>
</tr>
<tr>
<td><code>user_name</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr>
<td><code>user_password</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr>
<td><code>user_email</code></td>
<td><code>varchar(30)</code></td>
</tr>
<tr>
<td><code>role</code></td>
<td><code>enum(&apos;GUEST&apos;, &apos;USER&apos;, &apos;ADMIN&apos;)</code></td>
</tr>
</tbody>
</table>
<h3 id="the-model-classes">The model classes</h3>
<p>These are the model classes that play a role in the database interaction.
Class <code>User</code>:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.model;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Objects;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> Role role;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String name, String email, Role role)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.email = email;
        <span class="hljs-keyword">this</span>.role = role;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String name, String email, String password, Role role)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.email = email;
        <span class="hljs-keyword">this</span>.password = password;
        <span class="hljs-keyword">this</span>.role = role;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>{
        <span class="hljs-keyword">this</span>.password = password;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRole</span><span class="hljs-params">(Role role)</span> </span>{
        <span class="hljs-keyword">this</span>.role = role;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> email;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Role <span class="hljs-title">getRole</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> role;
    }
    <span class="hljs-comment">//toString(), equals(), hashCode() and getSome() omitted</span>
}
</code></pre>
<p>The enum <code>Role</code>:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.model;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Role {
    GUEST,
    USER,
    ADMIN;
}
</code></pre>
<p>and my custom Exception type:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.dao;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Exception</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseException</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseException</span><span class="hljs-params">(String message)</span> </span>{
        <span class="hljs-keyword">super</span>(message);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseException</span><span class="hljs-params">(String message, Throwable cause)</span> </span>{
        <span class="hljs-keyword">super</span>(message, cause);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DatabaseException</span><span class="hljs-params">(Throwable cause)</span> </span>{
        <span class="hljs-keyword">super</span>(cause);
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">DatabaseException</span><span class="hljs-params">(String message, Throwable cause, <span class="hljs-keyword">boolean</span> enableSuppression, <span class="hljs-keyword">boolean</span> writableStackTrace)</span> </span>{
        <span class="hljs-keyword">super</span>(message, cause, enableSuppression, writableStackTrace);
    }
}
</code></pre>
<h3 id="database-actions-within-intellij">Database actions within IntelliJ</h3>
<p>IntelliJ has excellent support for databases: it has an internal MySQL console, and supports autocomplete on in-code SQL statements and sql scripts.</p>
<p>To get this Database toolbox support active, you need let IntelliJ know about the database and follow these steps:</p>
<ul>
<li>View &#x2192; Tool Windows &#x2192; Database</li>
<li>Click &#x201C;+&#x201D; &#x2192; Data Source &#x2192; MySQL</li>
</ul>
<p><img src="figures/add_datasource1.png" alt="add_datasource1.png"></p>
<ul>
<li>Fill in the blanks</li>
</ul>
<p><img src="figures/add_datasource2.png" alt="add_datasource2.png"></p>
<ul>
<li>Click &quot;download missing driver files&quot;</li>
<li>Click &quot;test connection&quot;</li>
</ul>
<p>Note the URL it creates. Check that the data provided corresponds with your situation.</p>
<ul>
<li>Open the console, </li>
<li>Enter a command </li>
<li>Press <code>Ctrl + enter</code></li>
</ul>
<p><img src="figures/add_datasource3.png" alt="add_datasource3.png"></p>
<h3 id="add-data-to-the-db">Add data to the DB</h3>
<pre><code class="lang-mysql">DROP TABLE IF EXISTS Users;
CREATE TABLE Users (
    user_id INT NOT NULL auto_increment,
    user_name VARCHAR(100) NOT NULL,
    user_password VARCHAR(100) NOT NULL,
    user_email VARCHAR(255) NOT NULL,
    user_role VARCHAR(100) NOT NULL,
    primary key(user_id));

INSERT INTO Users (user_name, user_password, user_email, user_role)
VALUES (&apos;Henk&apos;, &apos;Henkie&apos;, &apos;Henk@example.com&apos;, &apos;ADMIN&apos;);
</code></pre>
<p>Of course, <strong><em>storing a password unencrypted is a very bad idea</em></strong>. We will address this aspect later.</p>
<p>Next, have a look at the DB tool window:</p>
<p><img src="figures/add_datasource4.png" alt="add_datasource4.png"></p>
<h2 id="code-against-interfaces-not-implementations">Code against interfaces, not implementations</h2>
<p>What we could do next is create a class responsible for all database interaction (<code>MyMySqlDbConnector</code>), and use this class all over our code base. Something like this:</p>
<pre><code class="lang-java">MyMySqlDbConnector dbConnector = <span class="hljs-keyword">new</span> MyMySqlDbConnector(url, user, pass);
</code></pre>
<p>Next year, after our application has grown, we decide a <strong><em>key-value store</em></strong> is better suited for our growing customer base. We create a new class, <code>MyCouchbaseConnector</code>. Unfortunately, everywhere we used the MySQL connector, we need to change our code to the new implementation.</p>
<pre><code class="lang-java">MyCouchbaseConnector dbConnector = <span class="hljs-keyword">new</span> MyCouchbaseConnector();
</code></pre>
<p>And if we are unlucky, the <code>MyCouchbaseConnector</code> has differing method signatures as well, making the refactoring process a hellish job.</p>
<p>That is such an unnecessary waste of time if we would have adhered to one of the prime directives of OO programming: <strong>Code against interfaces not implementations</strong> (where interface may mean interface as type, but also abstract class).</p>
<p>The key to this principle is following this series of steps:</p>
<ol>
<li><p>Think deeply about the contract: which methods do you need, disregarding the technology behind the scenes? This will be your interface definition.
Here is the interface specifying my user database interactions:</p>
<pre><code class="lang-java"> <span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.dao;

 <span class="hljs-keyword">import</span> nl.bioinf.wis_on_thymeleaf.model.Role;
 <span class="hljs-keyword">import</span> nl.bioinf.wis_on_thymeleaf.model.User;

 <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyAppDao</span></span>{

     <span class="hljs-comment">/**
     * connection logic should be put here
     * <span class="hljs-doctag">@throws</span> DatabaseException
     */</span>
     <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException</span>;

     <span class="hljs-comment">/**
     * shutdown logic should be put here
     * <span class="hljs-doctag">@throws</span> DatabaseException
     */</span>
     <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException</span>;
     <span class="hljs-comment">/**
     * fetches a user by username and password.
     * <span class="hljs-doctag">@param</span> userName
     * <span class="hljs-doctag">@param</span> userPass
     * <span class="hljs-doctag">@return</span>
     * <span class="hljs-doctag">@throws</span> DatabaseException
     */</span>
     <span class="hljs-function">User <span class="hljs-title">getUser</span><span class="hljs-params">(String userName, String userPass)</span> <span class="hljs-keyword">throws</span> DatabaseException</span>;

     <span class="hljs-comment">/**
     * inserts a new User.
     * <span class="hljs-doctag">@param</span> userName
     * <span class="hljs-doctag">@param</span> userPass
     * <span class="hljs-doctag">@param</span> email
     * <span class="hljs-doctag">@param</span> role
     * <span class="hljs-doctag">@throws</span> DatabaseException
     */</span>
     <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(String userName, String userPass, String email, Role role)</span> <span class="hljs-keyword">throws</span> DatabaseException</span>;
 }
</code></pre>
</li>
<li><p>Create a specific implementer:</p>
<pre><code class="lang-java"> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDbConnector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MyAppDao</span> </span>{ <span class="hljs-comment">/*details will follow*/</span> }
</code></pre>
</li>
<li><p>Create a factory class that will create and serve the right type of implementer, preferably based on some external configuration setting (do you know where to put that?).</p>
<pre><code class="lang-java"> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">someAppInitMethod</span><span class="hljs-params">()</span> </span>{
     MyDbConnector.createInstance(<span class="hljs-string">&quot;the_type&quot;</span>);
 }
</code></pre>
</li>
<li><p>Use the interface type in all the rest of you code base:</p>
<pre><code class="lang-java"> MyAppDao dao = MyDbConnector.getInstance();
</code></pre>
</li>
</ol>
<h2 id="create-a-mysql-implementer">Create a MySQL implementer</h2>
<h3 id="step-1-jdbc-class-loading">Step 1: JDBC class loading</h3>
<p>This mechanism is called <strong><em>dynamic class loading</em></strong>:</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> java.sql.*;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDbConnector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MyAppDao</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span></span>{
        Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);
    }
}
</code></pre>
<h3 id="step-2-create-a-connection">Step 2: create a Connection</h3>
<p>After loading the driver class(es), you will need to establish a connection:</p>
<pre><code class="lang-java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException </span>{
    <span class="hljs-keyword">try</span> {
        Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);
        String dbUrl = <span class="hljs-string">&quot;jdbc:mysql://MyHost/MyDbName&quot;</span>;
        String dbUser = <span class="hljs-string">&quot;Fred&quot;</span>;
        String dbPass = <span class="hljs-string">&quot;FredIsSafe&quot;</span>;
        <span class="hljs-keyword">this</span>.connection = DriverManager.getConnection(dbUrl, dbUser, dbPass);
    } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DatabaseException(<span class="hljs-string">&quot;Something is wrong with the database, see cause Exception&quot;</span>,
                    e.getCause());
        }
    }
}
</code></pre>
<p>Note that hardcoding your passwords in a repo that you are going to put online is not such a good idea.<br>Once you establish the connection, you have a live <code>java.sql.Connection</code> object. Talking to a database -an external resource- is risky business, so you have to put it in a try/catch block. In a real app, you should do something else with the exception than print it of course, but this post is not about exception handling. </p>
<p>That&apos;s it. The connection is ready for reading and writing.</p>
<h4 id="use-dbutils-to-read-your-credentials">Use DButils to read your credentials</h4>
<p>I have created a small helper app that you can use to prevent storing passowrds in your code. It reads your credentials from the <code>.my.cnf</code> file stored in your home folder.</p>
<p>You can clone and build the <a href="https://bitbucket.org/michiel_noback/dbutils" target="_blank">repo</a>
or download the jar <a href="../downloads/DButils-1.0.2.jar">here</a> and put it in your build path by adding the following line to the <code>build/gradle</code> file:</p>
<pre><code class="lang-gradle"><span class="hljs-keyword">compile</span> files(<span class="hljs-string">&apos;path/to/library/folder/DButils-1.0.2.jar&apos;</span>)
</code></pre>
<p>When you have it on the build path, simply use as follows:</p>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> nl.bioinf.noback.db_utils.DbCredentials;
<span class="hljs-keyword">import</span> nl.bioinf.noback.db_utils.DbUser;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DBCredDemo</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">useCredentials</span><span class="hljs-params">()</span> </span>{
        DbUser dbUser = DbCredentials.getMySQLuser();
        String user = dbUser.getUserName();
        String passWrd = dbUser.getDatabasePassword();
        String host = dbUser.getHost();
        String dbName = dbUser.getDatabaseName();
    }
}
</code></pre>
<p>assuming your <code>my.cnf</code> file has the correct entries:</p>
<pre><code class="lang-conf">[client]
user=&lt;db user name&gt;
password=&lt;db password&gt;
host=localhost
database=&lt;default database&gt;
</code></pre>
<h3 id="step-3-prepare-the-sql-statements">Step 3: prepare the SQL statements</h3>
<p>Using PreparedStatement instances makes it easier and far more efficient to repeat a query. Here are the two queries that are required for implementing the interface methods.</p>
<pre><code class="lang-java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String GET_USER = <span class="hljs-string">&quot;get_user&quot;</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String INSERT_USER = <span class="hljs-string">&quot;insert_user&quot;</span>;

    <span class="hljs-comment">/**
     * prepares prepared statements for reuse
     * <span class="hljs-doctag">@throws</span> SQLException
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareStatements</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>{
        String fetchQuery = <span class="hljs-string">&quot;SELECT * FROM Users WHERE user_name = ? AND user_password = ?&quot;</span>;
        PreparedStatement ps = connection.prepareStatement(fetchQuery);
        <span class="hljs-keyword">this</span>.preparedStatements.put(GET_USER, ps);

        String insertQuery = <span class="hljs-string">&quot;INSERT INTO Users (user_name, user_password, user_email, user_role) &quot;</span>
                        + <span class="hljs-string">&quot; VALUES (?, ?, ?, ?)&quot;</span>;
        ps = connection.prepareStatement(insertQuery);
        <span class="hljs-keyword">this</span>.preparedStatements.put(INSERT_USER, ps);
    }
</code></pre>
<p>The prepared statements are stored as entries of a Map which is an instance variable of the class.
The <code>?</code> characters serve as placeholders, to be replaced with actual values before executing the statement. See next section.</p>
<h3 id="step-4-implement-the-interface-methods">Step 4: Implement the interface methods</h3>
<h4 id="inserting-data">Inserting data</h4>
<p>Now you are ready to put some data in the database</p>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(String userName, String userPass, String email, Role role)</span> <span class="hljs-keyword">throws</span> DatabaseException  </span>{
        <span class="hljs-keyword">try</span>{
            PreparedStatement ps = <span class="hljs-keyword">this</span>.preparedStatements.get(INSERT_USER);
            ps.setString(<span class="hljs-number">1</span>, userName);
            ps.setString(<span class="hljs-number">2</span>, userPass);
            ps.setString(<span class="hljs-number">3</span>, email);
            ps.setString(<span class="hljs-number">4</span>, role.toString());
            ps.executeUpdate();
            ps.close();
        } <span class="hljs-keyword">catch</span> (Exception ex) {
            ex.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DatabaseException(<span class="hljs-string">&quot;Something is wrong with the database, see cause Exception&quot;</span>,
                    ex.getCause());
        }
    }
</code></pre>
<h4 id="fetching-data">Fetching data</h4>
<p>Fetching data is not unlike inserting data. The difference is that you get results of course. Results can be traversed throught the <code>ResultSet</code> object that you get back from <code>ResultSet rs = ps.executeQuery();</code>.</p>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">getUser</span><span class="hljs-params">(String userName, String userPass)</span> <span class="hljs-keyword">throws</span> DatabaseException  </span>{
        <span class="hljs-keyword">try</span> {
            PreparedStatement ps = <span class="hljs-keyword">this</span>.preparedStatements.get(GET_USER);
            ps.setString(<span class="hljs-number">1</span>, userName);
            ps.setString(<span class="hljs-number">2</span>, userPass);
            ResultSet rs = ps.executeQuery();
            <span class="hljs-keyword">while</span> (rs.next()) {
                String userMail = rs.getString(<span class="hljs-string">&quot;user_email&quot;</span>);
                String userIdStr = rs.getString(<span class="hljs-string">&quot;user_id&quot;</span>);
                String userRoleStr = rs.getString(<span class="hljs-string">&quot;user_role&quot;</span>);
                Role role = Role.valueOf(userRoleStr);
                User user = <span class="hljs-keyword">new</span> User(userName, userPass, userMail, role);
                <span class="hljs-keyword">return</span> user;
            }
            rs.close();
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DatabaseException(<span class="hljs-string">&quot;Something is wrong with the database, see cause Exception&quot;</span>,
                    e.getCause());

        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
</code></pre>
<p>Here, you see the use of <code>while (rs.next()) {}</code> which is not entirely logical if you expect a single result, as in this case. Maybe it is better to add some checks, such as:</p>
<pre><code class="lang-java"><span class="hljs-keyword">if</span> (rs.getFetchSize() &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DatabaseException(<span class="hljs-string">&quot;something wrong&quot;</span>);
}
</code></pre>
<h3 id="step-5-cleanup-code">Step 5: cleanup code</h3>
<p>After you are done, you must <strong>carefully</strong> clean up your database resources.</p>
<p>Here is my <code>disconnect()</code> implementation:</p>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException </span>{
        <span class="hljs-keyword">try</span>{
            <span class="hljs-keyword">for</span>( String key : <span class="hljs-keyword">this</span>.preparedStatements.keySet() ){
                <span class="hljs-keyword">this</span>.preparedStatements.get(key).close();
            }
        }<span class="hljs-keyword">catch</span>( Exception e ){
            e.printStackTrace();
        }
        <span class="hljs-keyword">finally</span>{
            <span class="hljs-keyword">try</span> {
                connection.close();
            } <span class="hljs-keyword">catch</span> (SQLException e) {
                e.printStackTrace();
            }
        }
    }
</code></pre>
<p>So, which objects need to be close explicitly:</p>
<ul>
<li><code>ResultSet</code> (here: done in method itself)</li>
<li><code>PreparedStatemenent</code></li>
<li><code>Connection</code> (always last)</li>
</ul>
<h3 id="clean-up-the-code-and-implement-singleton">Clean up the code and implement Singleton</h3>
<p>Now we know it works, it is time to move the use of <code>DbCredentials</code> somewhere else, out of the <code>MyAppDaoMySQL</code> class. Reason: it is not according to the SRP. In this implementation, it is moved to the <code>MyAppDaoFactory</code> class (see below). </p>
<p>Also, I want class <code>DbCredentials</code> to be instantiated only once - we do not want to create resource-heavy classes twice if we can prevent it. To guarantee this, the <strong><em>singleton pattern</em></strong> is implemented.  It has three components:</p>
<ul>
<li>a private static instance</li>
<li>a private constructor (only this class can instantiate itself)</li>
<li>a public static method serving the single instance</li>
</ul>
<pre><code class="lang-java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MyAppDaoMySQL uniqueInstance;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">MyAppDaoMySQL</span><span class="hljs-params">(String url, String dbUser, String dbPassword)</span> </span>{
        <span class="hljs-keyword">this</span>.url = url;
        <span class="hljs-keyword">this</span>.dbUser = dbUser;
        <span class="hljs-keyword">this</span>.dbPassword = dbPassword;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MyAppDaoMySQL <span class="hljs-title">getInstance</span><span class="hljs-params">(String url, String dbUser, String dbPassword)</span> </span>{
        <span class="hljs-comment">//lazy instantiation</span>
        <span class="hljs-keyword">if</span> (uniqueInstance == <span class="hljs-keyword">null</span>) {
            uniqueInstance = <span class="hljs-keyword">new</span> MyAppDaoMySQL(url, dbUser, dbPassword);
        }
        <span class="hljs-keyword">return</span> uniqueInstance;
    }
</code></pre>
<p>Key here is the private constructor which guarantees ony code within class <code>MyAppDaoMySQL</code> can instantiate its objects, and it does so only once.
This solution is simple, but <strong>not thread safe!</strong>. In a later course, we&apos;ll revisit this.</p>
<h2 id="create-a-factory-class">Create a factory class</h2>
<p>Now we have an implementer of the interface, it is time to make the API available to the application. We do this via a <strong><em>factory class</em></strong>, which is a class whose task it is to create and serve objects implementing a specific interface, based on some parameter.</p>
<p>This is the factory class:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.dao;

<span class="hljs-keyword">import</span> nl.bioinf.noback.db_utils.DbCredentials;
<span class="hljs-keyword">import</span> nl.bioinf.noback.db_utils.DbUser;

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAppDaoFactory</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MyAppDao daoInstance;

    <span class="hljs-comment">/**
     * Code should be called at application startup
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initializeDataSource</span><span class="hljs-params">(String type)</span> <span class="hljs-keyword">throws</span> DatabaseException </span>{
        <span class="hljs-keyword">if</span> (daoInstance != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;DAO can be initialized only once&quot;</span>);
        }
        <span class="hljs-keyword">switch</span>(type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;dummy&quot;</span>: {
                createDummyInstance();
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;mysql&quot;</span>: {
                createMySQLInstance();
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;unknown database type requested&quot;</span>);
        }
    }

    <span class="hljs-comment">/**
     * serves the dao instance
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MyAppDao <span class="hljs-title">getDataSource</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (daoInstance == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;DAO is not initialized; call initializeDataSource() first&quot;</span>);
        }
        <span class="hljs-keyword">return</span> daoInstance;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createDummyInstance</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException </span>{
        daoInstance = <span class="hljs-keyword">new</span> MyAppDaoInMemory();
        daoInstance.connect();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createMySQLInstance</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> DatabaseException </span>{
        <span class="hljs-keyword">try</span> {
            DbUser mySQLuser = DbCredentials.getMySQLuser();
            String dbUrl = <span class="hljs-string">&quot;jdbc:mysql://&quot;</span> + mySQLuser.getHost() + <span class="hljs-string">&quot;/&quot;</span> + mySQLuser.getDatabaseName();
            String dbUser = mySQLuser.getUserName();
            String dbPass = mySQLuser.getDatabasePassword();
            daoInstance = MyAppDaoMySQL.getInstance(dbUrl, dbUser, dbPass);
            daoInstance.connect();
        } <span class="hljs-keyword">catch</span> (IOException | NoSuchFieldException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> DatabaseException(e);
        }
    }
}
</code></pre>
<p>When the MySQL type is requested for initialization, the url, name and password need to be provided. It is read from the <code>.my.cnf</code> file as shown before.</p>
<h2 id="get-hold-of-the-dao-implementation-whatever-that-may-be">Get hold of the dao implementation, whatever that may be</h2>
<p>The <code>web.xml</code> deployment descriptor is an excellent place to specify which implementation of the <code>MyAppDao</code> interface to use:</p>
<pre><code class="lang-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>db_type<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span>
</code></pre>
<p>Finally, the datasource need to be initialized at application startup, requested from the class <code>MyAppDaoFactory</code>. 
You have seen the application startup hook in a previous post (see <a href="servlet_details.html">servlet details and lifecycle hooks</a>); 
it was implemented in class <code>WebConfig</code>.
Here, the DAO initialization is done within that method, <code>contextInitialized()</code>.</p>
<pre><code class="lang-java"><span class="hljs-meta">@WebListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextListener</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent servletContextEvent)</span> </span>{
        <span class="hljs-comment">//other code</span>

        <span class="hljs-comment">//fetch the database type</span>
        String dbType = servletContextEvent.getServletContext().getInitParameter(<span class="hljs-string">&quot;db-type&quot;</span>);
        <span class="hljs-keyword">try</span> {
            MyAppDaoFactory.initializeDataSource(dbType);
        } <span class="hljs-keyword">catch</span> (DatabaseException e) {
            e.printStackTrace();
            <span class="hljs-comment">//this should be logged of course; and dealt with elegantly</span>
        }
    }
    <span class="hljs-comment">//other code</span>
}
</code></pre>
<p>Finally, test!</p>
<p>Here is the relevant servlet code:</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>{
        <span class="hljs-keyword">final</span> MyAppDao dataSource = MyAppDaoFactory.getDataSource();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">final</span> User user = dataSource.getUser(<span class="hljs-string">&quot;Henk&quot;</span>, <span class="hljs-string">&quot;Henkie&quot;</span>);
            <span class="hljs-keyword">final</span> TemplateEngine templateEngine = WebConfig.getTemplateEngine();
            WebContext ctx = <span class="hljs-keyword">new</span> WebContext(request, response, request.getServletContext(), request.getLocale());
            ctx.setVariable(<span class="hljs-string">&quot;user&quot;</span>, user);
            templateEngine.process(<span class="hljs-string">&quot;user-details&quot;</span>, ctx, response.getWriter());
        } <span class="hljs-keyword">catch</span> (DatabaseException e) {
            e.printStackTrace();
        }
</code></pre>
<p>and the thymeleaf view:</p>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html SYSTEM &quot;http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Show user<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/myPage.js&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-comment">&lt;!-- welcome message read from resource bundle welcome.html--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&apos;Welcome &apos; + ${user.name}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&apos;Your account email: &apos; + ${user.email}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;&apos;Your Role: &apos; + ${user.role.name}&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Below you see the results with the two different values for the same <code>web.xml</code> context-param entry. The code does not know which implementation is running.</p>
<p><strong>db-type=mysql</strong><br>Here, the MySQL database is queried:</p>
<p><img src="figures/datasource_mysql.png" alt="mysql-Henk"></p>
<p><strong>db-type=dummy</strong><br>And this queries the internal dummy database:</p>
<p><img src="figures/datasource_dummy.png" alt="mysql-Henk"></p>
<p>This constitutes the final layer in the app: the data layer:</p>
<p><img src="figures/mvc_with_data_layer.png" alt="mvc"></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="servlet_details.html" class="navigation navigation-prev " aria-label="Previous page: Servlet details & Lifecycle hooks">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="ajax.html" class="navigation navigation-next " aria-label="Next page: Ajax communication">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Database interaction","level":"7.9","depth":1,"next":{"title":"Ajax communication","level":"7.10","depth":1,"path":"05_web/ajax.md","ref":"05_web/ajax.md","articles":[]},"previous":{"title":"Servlet details & Lifecycle hooks","level":"7.8","depth":1,"path":"05_web/servlet_details.md","ref":"05_web/servlet_details.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["page-toc"],"pluginsConfig":{"page-toc":{"position":"before-first","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3","showByDefault":true},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"05_web/databases.md","mtime":"2019-11-12T15:37:29.387Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-14T15:30:03.587Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

