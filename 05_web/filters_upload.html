
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Web filters and file uploads Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="ajax.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../shortcuts.html">
            
                <a href="../shortcuts.html">
            
                    
                    IntelliJ keyboard shortcuts
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: Getting started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../01_getting_started/intellij.html">
            
                <a href="../01_getting_started/intellij.html">
            
                    
                    A first IntelliJ project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../01_getting_started/essentials.html">
            
                <a href="../01_getting_started/essentials.html">
            
                    
                    The essentials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../01_getting_started/first_look_at_objects.html">
            
                <a href="../01_getting_started/first_look_at_objects.html">
            
                    
                    Demo case: A first look at objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../02_syntax/basic_program_design.html">
            
                <a href="../02_syntax/basic_program_design.html">
            
                    
                    Basic program design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../02_syntax/naming_commenting.html">
            
                <a href="../02_syntax/naming_commenting.html">
            
                    
                    Naming and commenting
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 2: Syntax</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../02_syntax/data_types.html">
            
                <a href="../02_syntax/data_types.html">
            
                    
                    Data types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../02_syntax/arrays.html">
            
                <a href="../02_syntax/arrays.html">
            
                    
                    Arrays
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../02_syntax/operators.html">
            
                <a href="../02_syntax/operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../02_syntax/flow_control.html">
            
                <a href="../02_syntax/flow_control.html">
            
                    
                    Flow control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../02_syntax/methods.html">
            
                <a href="../02_syntax/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../02_syntax/packages_imports.html">
            
                <a href="../02_syntax/packages_imports.html">
            
                    
                    Packages & Imports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../02_syntax/demo_case_naming.html">
            
                <a href="../02_syntax/demo_case_naming.html">
            
                    
                    Demo case: The power of good names
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 3: Core APIs</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../03_apis/interfaces.html">
            
                <a href="../03_apis/interfaces.html">
            
                    
                    Interfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../03_apis/collections.html">
            
                <a href="../03_apis/collections.html">
            
                    
                    Collections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../03_apis/class_object_methods.html">
            
                <a href="../03_apis/class_object_methods.html">
            
                    
                    Methods of class Object
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../03_apis/sorting.html">
            
                <a href="../03_apis/sorting.html">
            
                    
                    Sorting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../03_apis/exceptions.html">
            
                <a href="../03_apis/exceptions.html">
            
                    
                    Exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../03_apis/io.html">
            
                <a href="../03_apis/io.html">
            
                    
                    File IO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../03_apis/regex.html">
            
                <a href="../03_apis/regex.html">
            
                    
                    Regular Expressions
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 4: Object-oriented programming</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../04_oop/class_design.html">
            
                <a href="../04_oop/class_design.html">
            
                    
                    Encapsulation through access modifiers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../04_oop/access_modifiers.html">
            
                <a href="../04_oop/access_modifiers.html">
            
                    
                    Access modifiers & other keywords
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../04_oop/inheritance.html">
            
                <a href="../04_oop/inheritance.html">
            
                    
                    Inheritance and UML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../04_oop/enums.html">
            
                <a href="../04_oop/enums.html">
            
                    
                    Enums
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../04_oop/encapsulation.html">
            
                <a href="../04_oop/encapsulation.html">
            
                    
                    Encapsulation revisited
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../04_oop/inner_classes.html">
            
                <a href="../04_oop/inner_classes.html">
            
                    
                    Inner classes
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Summaries Part 1-4</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../design_rules.html">
            
                <a href="../design_rules.html">
            
                    
                    Design Rules summary
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 5: Web-based Java & Thymeleaf</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="refresher.html">
            
                <a href="refresher.html">
            
                    
                    Refresher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="toolbox.html">
            
                <a href="toolbox.html">
            
                    
                    Toolbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="first_project.html">
            
                <a href="first_project.html">
            
                    
                    A first project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="mvc.html">
            
                <a href="mvc.html">
            
                    
                    Implementing MVC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="thymeleaf_expressions.html">
            
                <a href="thymeleaf_expressions.html">
            
                    
                    Thymeleaf expression types & objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="thymeleaf_flow_control.html">
            
                <a href="thymeleaf_flow_control.html">
            
                    
                    Thymeleaf flow control & fragments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="sessions.html">
            
                <a href="sessions.html">
            
                    
                    Sessions & Scopes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="servlet_details.html">
            
                <a href="servlet_details.html">
            
                    
                    Servlet details & Lifecycle hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.9" data-path="databases.html">
            
                <a href="databases.html">
            
                    
                    Database interaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.10" data-path="ajax.html">
            
                <a href="ajax.html">
            
                    
                    Ajax communication
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="7.11" data-path="filters_upload.html">
            
                <a href="filters_upload.html">
            
                    
                    Web filters and file uploads
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Web filters and file uploads</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="web-filters-and-file-uploads">Web filters and File uploads</h1>
<h2 id="introduction">Introduction</h2>
<p>This is the last post in this course. It deals with two loose ends: uploading files and intercepting requests.</p>
<h2 id="web-filters">Web filters</h2>
<p>Suppose you want to intercept requests for a (group of) servlets, to log what is requested and where it came from.
For instance, to do analyse the web traffic later on in order to pinpoint the most used resources.<br>Or more relevant: intercept requests to asses authentication status of the user. And reject a request if the user is not authorized to see a resource.</p>
<h3 id="a-basic-example">A basic example</h3>
<p>Here is our old friend, the PhraseServlet (only relevant code show):</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.servlets;

<span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">&quot;PhraseServlet&quot;</span>, urlPatterns = <span class="hljs-string">&quot;/give.phrase&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhraseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{
    <span class="hljs-keyword">private</span> TemplateEngine templateEngine;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span>
            <span class="hljs-keyword">throws</span> ServletException, IOException </span>{
        String phraseType = request.getParameter(<span class="hljs-string">&quot;phrase_category&quot;</span>);
        Locale locale = request.getLocale();
        WebContext ctx = <span class="hljs-keyword">new</span> WebContext(request, response, request.getServletContext(), locale);
        String phrase = PhraseFactory.getPhrase(phraseType);
        ctx.setVariable(<span class="hljs-string">&quot;phrase_type&quot;</span>, phraseType);
        ctx.setVariable(<span class="hljs-string">&quot;phrase_num&quot;</span>, phrase);
        templateEngine.process(<span class="hljs-string">&quot;phrase_of_the_day&quot;</span>, ctx, response.getWriter());
    }
}
</code></pre>
<p>This is the way to keep track of requests for <code>/give.phrase</code>; a <code>@WebFilter</code> annotation on a class implementing <code>javax.servlet.Filter</code> does the trick:</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.webfilters;

<span class="hljs-keyword">import</span> javax.servlet.*;
<span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-meta">@WebFilter</span>(urlPatterns = <span class="hljs-string">&quot;/give.phrase&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhraseServletFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span></span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">instanceof</span> HttpServletRequest) {
            System.out.println(<span class="hljs-string">&quot;Request for &quot;</span> + ((HttpServletRequest)request).getRequestURL().toString());
            System.out.println(<span class="hljs-string">&quot;Query: &quot;</span> + ((HttpServletRequest)request).getQueryString());
            System.out.println(<span class="hljs-string">&quot;Remote address: &quot;</span> + request.getRemoteAddr());
        }
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//pass on the request after you are done</span>
            chain.doFilter(request, response);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-comment">/*not interesting here*/</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">/*not interesting here*/</span>
    }
}
</code></pre>
<p>Whe the <code>/give.phrase?phrase_category=bullshit</code> resource is requested, the Tomcat logs show</p>
<pre class="console_out">
Request for http://localhost:8080/give.phrase
Query: phrase_category=bullshit
Remote address: 0:0:0:0:0:0:0:1
</pre>

<h3 id="check-for-authentication">Check for authentication</h3>
<p>Suppose you have an application with a few public pages and a few pages for which authentication is required. This is a typical use case for WebFilter.</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.webfilters;


<span class="hljs-keyword">import</span> javax.servlet.*;
<span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-meta">@WebFilter</span>(urlPatterns = {<span class="hljs-string">&quot;/user.dashboard&quot;</span>, <span class="hljs-string">&quot;/list.secrets&quot;</span>}) <span class="hljs-comment">//use &quot;/*&quot; for catch-all</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AuthenticationFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>{
        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">instanceof</span> HttpServletRequest) {
            HttpServletRequest req = ((HttpServletRequest)request);
            System.out.println(<span class="hljs-string">&quot;[AuthenticationFilter] Intercepted URL: &quot;</span> + req.getRequestURL().toString());
            <span class="hljs-keyword">final</span> HttpSession session = req.getSession();
            <span class="hljs-keyword">if</span> (session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>) == <span class="hljs-keyword">null</span>) {
                System.out.println(<span class="hljs-string">&quot;[AuthenticationFilter] no authenticated user: redirecting to /login&quot;</span>);
                ((HttpServletResponse)response).sendRedirect(<span class="hljs-string">&quot;/login&quot;</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">&quot;[AuthenticationFilter] authenticated status checked; user= &quot;</span> + session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>));
                <span class="hljs-keyword">try</span> {
                    chain.doFilter(request, response);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-comment">/*not interesting here*/</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">/*not interesting here*/</span>
    }
}
</code></pre>
<p>Here is the output after a few requests</p>
<pre class="console_out">
[AuthenticationFilter] Intercepted URL: http://localhost:8080/list.secrets 
[AuthenticationFilter] no authenticated user: redirecting to /login

&lt;logged in as Henk&gt;

[AuthenticationFilter] Intercepted URL: http://localhost:8080/list.secrets 
[AuthenticationFilter] authenticated status checked; user= User{name=&apos;Henk&apos;, email=&apos;henk@example.com&apos;, password=&apos;null&apos;, role=USER}
[AuthenticationFilter] Intercepted URL: http://localhost:8080/user.dashboard 
[AuthenticationFilter] authenticated status checked; user= User{name=&apos;Henk&apos;, email=&apos;henk@example.com&apos;, password=&apos;null&apos;, role=USER}
</pre>

<h2 id="file-uploads">File uploads</h2>
<p>File Upload is an essential feature! Many websites provide some form of upload functionality:</p>
<ul>
<li>Photos &amp; Video</li>
<li>Data</li>
<li>Configuration</li>
</ul>
<p>Fortunately, uploading is boilerplate code!</p>
<p>The harder thing is: what will you do with the file?</p>
<ul>
<li>Into database</li>
<li>Store locally </li>
<li>Process directly</li>
</ul>
<h3 id="upload-form">Upload form</h3>
<p>Suppose we want to offer a scv data upload.
Here is the html for uploading csv data. Key are <code>enctype=&quot;multipart/form-data&quot;</code> in the <code>form</code> tag and the <code>&lt;input type=&quot;file&quot; name=&quot;scv_data&quot; accept=&quot;text/csv&quot;&gt;</code> tag. </p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@{&apos;data_upload&apos;}&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;scv_data&quot;</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">&quot;text/csv&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Upload&quot;</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p>The servlet handling the file upload needs to be annotated as such:</p>
<pre><code class="lang-java"><span class="hljs-meta">@MultipartConfig</span>(location=<span class="hljs-string">&quot;/tmp&quot;</span>,
        fileSizeThreshold = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
        maxFileSize = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">5</span>,
        maxRequestSize = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">5</span> * <span class="hljs-number">5</span>)
<span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">&quot;FileUploadServlet&quot;</span>, urlPatterns = <span class="hljs-string">&quot;/data_upload&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{
    <span class="hljs-comment">//class body</span>
}
</code></pre>
<p>The <code>@MultipartConfig</code> annotation has several parameters:</p>
<ul>
<li><strong><em>location</em></strong>: An absolute path to a directory on the file system. This location is used to store files temporarily while the parts are processed or when the size of the file exceeds the specified <code>fileSizeThreshold</code> setting. The default location is &quot;&quot;.</li>
<li><strong><em>fileSizeThreshold</em></strong>: The file size in bytes after which the file will be temporarily stored on disk. The default size is 0 bytes.</li>
<li><strong><em>maxFileSize</em></strong>: The maximum size allowed for uploaded files, in bytes. If the size is greater, the container will throw an exception (<code>IllegalStateExceptio</code>n). The default size is unlimited.</li>
<li><strong><em>maxRequestSize</em></strong>: The maximum size allowed for a multipart/form-data request, in bytes. The web container will throw an exception if the overall size of all uploaded files exceeds this threshold. The default size is unlimited.</li>
</ul>
<p>Instead of hardcoding the constraints, you can also put them in web.xml:</p>
<pre><code class="lang-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>FileUploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/data_upload<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>FileUploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>nl.bioinf.wis_on_thymeleaf.servlets.FileUploadServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>upload_dir<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/path/to/file/upload<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">multipart-config</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">location</span>&gt;</span>/path/to/tmp/tmp<span class="hljs-tag">&lt;/<span class="hljs-name">location</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- all in bytes --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">max-file-size</span>&gt;</span>20848820<span class="hljs-tag">&lt;/<span class="hljs-name">max-file-size</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">max-request-size</span>&gt;</span>418018841<span class="hljs-tag">&lt;/<span class="hljs-name">max-request-size</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">file-size-threshold</span>&gt;</span>1048576<span class="hljs-tag">&lt;/<span class="hljs-name">file-size-threshold</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">multipart-config</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
</code></pre>
<p>Here is the servlet dealing with the uploads. The final upload location is specified using an <code>init-param</code> in the <code>web.xml</code> deployment descriptor of course.</p>
<pre><code class="lang-java"><span class="hljs-keyword">package</span> nl.bioinf.wis_on_thymeleaf.servlets;

<span class="hljs-keyword">import</span> nl.bioinf.wis_on_thymeleaf.config.WebConfig;
<span class="hljs-keyword">import</span> org.thymeleaf.TemplateEngine;
<span class="hljs-keyword">import</span> org.thymeleaf.context.WebContext;

<span class="hljs-keyword">import</span> javax.servlet.ServletException;
<span class="hljs-keyword">import</span> javax.servlet.http.Part;
<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-comment">//moved to web.xml</span>
<span class="hljs-comment">//@MultipartConfig(location=&quot;/tmp&quot;,</span>
<span class="hljs-comment">//        fileSizeThreshold = 1024 * 1024,</span>
<span class="hljs-comment">//        maxFileSize = 1024 * 1024 * 5,</span>
<span class="hljs-comment">//        maxRequestSize = 1024 * 1024 * 5 * 5)</span>
<span class="hljs-meta">@WebServlet</span>(name = <span class="hljs-string">&quot;FileUploadServlet&quot;</span>, urlPatterns = <span class="hljs-string">&quot;/data_upload&quot;</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUploadServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>{

    <span class="hljs-keyword">private</span> TemplateEngine templateEngine;
    <span class="hljs-keyword">private</span> String uploadDir;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ServletException </span>{
        <span class="hljs-keyword">this</span>.templateEngine = WebConfig.getTemplateEngine();
        <span class="hljs-keyword">this</span>.uploadDir = getInitParameter(<span class="hljs-string">&quot;upload_dir&quot;</span>);

        <span class="hljs-comment">//or, use relative to this app:</span>
        <span class="hljs-comment">// gets absolute path of the web application</span>
        <span class="hljs-comment">//String applicationPath = getServletContext().getRealPath(&quot;&quot;);</span>
        <span class="hljs-comment">//String uploadFilePath = applicationPath + File.separator + uploadDir;</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>{
        <span class="hljs-comment">//simply go back to upload form</span>
        WebContext ctx = <span class="hljs-keyword">new</span> WebContext(request, response, request.getServletContext(), request.getLocale());
        templateEngine.process(<span class="hljs-string">&quot;upload_form&quot;</span>, ctx, response.getWriter());
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>{
        File fileSaveDir = <span class="hljs-keyword">new</span> File(<span class="hljs-keyword">this</span>.uploadDir);
        <span class="hljs-keyword">if</span> (! fileSaveDir.exists()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;Upload dir does not exist: &quot;</span> + <span class="hljs-keyword">this</span>.uploadDir);
        }

        <span class="hljs-comment">//Do this only if you are sure there won&apos;t be any file name conflicts!</span>
        <span class="hljs-comment">//An existing one will simply be overwritten</span>
<span class="hljs-comment">//        String fileName;</span>
<span class="hljs-comment">//        for (Part part : request.getParts()) {</span>
<span class="hljs-comment">//            fileName = part.getSubmittedFileName();</span>
<span class="hljs-comment">//            part.write(this.uploadDir + File.separator + fileName);</span>
<span class="hljs-comment">//        }</span>

        <span class="hljs-comment">//the safe way, with a generated file name becomes something like this</span>
        <span class="hljs-comment">//my_app_upload14260971264207930189.csv</span>
        File generatedFile = File.createTempFile(<span class="hljs-string">&quot;my_app_upload&quot;</span>, <span class="hljs-string">&quot;.csv&quot;</span>);
        <span class="hljs-keyword">for</span> (Part part : request.getParts()) {
            part.write(<span class="hljs-keyword">this</span>.uploadDir + File.separator + generatedFile.getName());
        }

        <span class="hljs-comment">//go back to the upload form</span>
        WebContext ctx = <span class="hljs-keyword">new</span> WebContext(request, response, request.getServletContext(), request.getLocale());
        ctx.setVariable(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;upload successfull, wanna do another on?&quot;</span>);
        templateEngine.process(<span class="hljs-string">&quot;upload_form&quot;</span>, ctx, response.getWriter());
    }
}
</code></pre>
<p>If you want to be sure files won&apos;t get overwritten, you should use random generated file names, as in the above code example. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ajax.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Ajax communication">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Web filters and file uploads","level":"7.11","depth":1,"previous":{"title":"Ajax communication","level":"7.10","depth":1,"path":"05_web/ajax.md","ref":"05_web/ajax.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"05_web/filters_upload.md","mtime":"2019-06-12T08:54:20.676Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-06-12T09:11:58.678Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

